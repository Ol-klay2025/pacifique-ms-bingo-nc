<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration KYC - PACIFIQUE MS BINGO</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="/css/styles.css">
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="./js/risk-scoring.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f9fd;
            margin: 0;
            padding: 0;
            color: #37474f;
        }
        
        /* Styles pour les menus d√©roulants d'exportation */
        .export-dropdown {
            position: relative;
            display: inline-block;
            margin-right: 10px;
        }
        
        .export-dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: #fff;
            min-width: 180px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            z-index: 100;
            border-radius: 4px;
            margin-top: 5px;
        }
        
        .export-dropdown:hover .export-dropdown-content {
            display: block;
        }
        
        .export-dropdown-content a {
            color: #37474f;
            padding: 10px 15px;
            text-decoration: none;
            display: block;
            transition: background-color 0.2s;
            font-size: 14px;
        }
        
        .export-dropdown-content a:hover {
            background-color: #f5f9fd;
            color: #1976d2;
        }
        
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .admin-header {
            margin-bottom: 30px;
        }
        
        .admin-header h1 {
            color: #0d47a1;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .admin-header p {
            color: #546e7a;
            font-size: 16px;
            margin: 0;
        }
        
        .admin-tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
        }
        
        .admin-tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            font-size: 16px;
            font-weight: 500;
            color: #546e7a;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .admin-tab:hover {
            color: #1976d2;
        }
        
        .admin-tab.active {
            color: #1976d2;
        }
        
        .admin-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #1976d2;
        }
        
        .admin-tab-content {
            display: none;
        }
        
        .admin-tab-content.active {
            display: block;
        }
        
        .admin-dashboard-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .admin-dashboard-card {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .admin-dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .admin-dashboard-card-title {
            font-size: 14px;
            color: #546e7a;
            margin-bottom: 10px;
        }
        
        .admin-dashboard-card-value {
            font-size: 28px;
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .admin-dashboard-card-trend {
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .admin-dashboard-card-trend.up {
            color: #2e7d32;
        }
        
        .admin-dashboard-card-trend.down {
            color: #c62828;
        }
        
        .admin-dashboard-card.pending {
            border-top: 3px solid #ff9800;
        }
        
        .admin-dashboard-card.approved {
            border-top: 3px solid #2e7d32;
        }
        
        .admin-dashboard-card.rejected {
            border-top: 3px solid #c62828;
        }
        
        .admin-dashboard-card.processing-time {
            border-top: 3px solid #1976d2;
        }
        
        .admin-card {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .admin-card-header {
            background-color: #e3f2fd;
            padding: 15px 20px;
            border-bottom: 1px solid #bbdefb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-card-header h2 {
            margin: 0;
            font-size: 20px;
            color: #1976d2;
        }
        
        .admin-card-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        
        .admin-card-actions {
            display: flex;
            gap: 10px;
        }
        
        .admin-button.small {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .admin-card-header .badge {
            background-color: #ff9800;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .admin-card-body {
            padding: 20px;
        }
        
        .admin-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .admin-filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .admin-filter-label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #455a64;
        }
        
        .admin-filter-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .admin-table-container {
            overflow-x: auto;
        }
        
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .admin-table th {
            background-color: #f5f5f5;
            padding: 12px 15px;
            text-align: left;
            font-weight: 500;
            color: #455a64;
            border-bottom: 1px solid #e0e0e0;
            position: sticky;
            top: 0;
        }
        
        .admin-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .admin-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .admin-table tr:last-child td {
            border-bottom: none;
        }
        
        .admin-table tr.high-risk {
            background-color: #ffeaeb;
        }
        
        .admin-table tr.high-risk:hover {
            background-color: #ffcdd2;
        }
        
        .admin-table tr.medium-risk {
            background-color: #fff8e1;
        }
        
        .admin-table tr.medium-risk:hover {
            background-color: #ffe082;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 500;
            font-size: 12px;
            text-transform: uppercase;
        }
        
        .status-badge.pending {
            background-color: #fff9c4;
            color: #f57f17;
        }
        
        .status-badge.approved {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .status-badge.rejected {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .status-badge.flagged {
            background-color: #ffcdd2;
            color: #b71c1c;
        }
        
        .status-badge.reviewing {
            background-color: #e3f2fd;
            color: #0d47a1;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            font-size: 13px;
            transition: background-color 0.2s ease;
        }
        
        .action-button.view {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .action-button.view:hover {
            background-color: #bbdefb;
        }
        
        .action-button.approve {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .action-button.approve:hover {
            background-color: #c8e6c9;
        }
        
        .action-button.reject {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .action-button.reject:hover {
            background-color: #ffcdd2;
        }
        
        .action-button.flag {
            background-color: #fff3e0;
            color: #e65100;
        }
        
        .action-button.flag:hover {
            background-color: #ffe0b2;
        }
        
        .admin-pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }
        
        .pagination-info {
            color: #78909c;
            font-size: 14px;
        }
        
        .pagination-buttons {
            display: flex;
            gap: 8px;
        }
        
        .pagination-button {
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            background-color: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .pagination-button:hover {
            background-color: #f5f5f5;
        }
        
        .pagination-button.active {
            background-color: #1976d2;
            color: white;
            border-color: #1976d2;
        }
        
        .pagination-button:disabled {
            background-color: #f5f5f5;
            color: #bdbdbd;
            cursor: not-allowed;
        }
        
        .admin-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .admin-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .admin-modal-content {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            width: 95%;
            max-width: 1200px;
            height: 90vh;
            overflow: hidden;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .admin-modal.active .admin-modal-content {
            transform: translateY(0);
        }
        
        .admin-modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        
        .admin-modal-header h3 {
            margin: 0;
            font-size: 18px;
            color: #1976d2;
        }
        
        .admin-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #78909c;
        }
        
        .admin-modal-body {
            padding: 20px;
            overflow-y: auto;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .admin-modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            flex-shrink: 0;
            background-color: #fff;
        }
        
        .admin-user-info {
            margin-bottom: 20px;
            background-color: #f5f9fd;
            padding: 15px;
            border-radius: 6px;
        }
        
        .admin-user-info h4 {
            margin: 0 0 10px;
            color: #1976d2;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .admin-user-info h4 .risk-indicator {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: normal;
        }
        
        .admin-user-info h4 .risk-indicator.high {
            background-color: #ffcdd2;
            color: #b71c1c;
        }
        
        .admin-user-info h4 .risk-indicator.medium {
            background-color: #ffe082;
            color: #e65100;
        }
        
        .admin-user-info h4 .risk-indicator.low {
            background-color: #c8e6c9;
            color: #2e7d32;
        }
        
        /* Styles pour la jauge de score de risque */
        .risk-score-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 8px;
            width: 100%;
        }
        
        .risk-score-gauge {
            width: 100%;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        
        .risk-score-fill {
            height: 100%;
            background: linear-gradient(to right, #4caf50, #ffeb3b, #f44336);
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }
        
        .risk-score-value {
            font-size: 13px;
            font-weight: 500;
            color: #37474f;
        }
        
        /* Styles pour le modal de facteurs de risque */
        .risk-score-gauge-large {
            width: 100%;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .risk-score-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .risk-score-label #risk-score-percent {
            font-size: 18px;
            font-weight: 600;
        }
        
        .risk-score-label #risk-level-text {
            font-size: 16px;
            font-weight: 500;
            padding: 2px 10px;
            border-radius: 4px;
            background-color: #ffe082;
            color: #e65100;
        }
        
        .risk-factors-container {
            margin-bottom: 20px;
        }
        
        .risk-factor-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            transition: background-color 0.2s ease;
        }
        
        .risk-factor-item:hover {
            background-color: #f5f5f5;
        }
        
        .risk-factor-item:last-child {
            border-bottom: none;
        }
        
        .risk-factor-name {
            font-weight: 500;
            flex: 1;
        }
        
        .risk-factor-impact {
            width: 100px;
            text-align: center;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 500;
            font-size: 14px;
        }
        
        .risk-factor-impact.high {
            background-color: #ffcdd2;
            color: #c62828;
        }
        
        .risk-factor-impact.medium {
            background-color: #ffe0b2;
            color: #e65100;
        }
        
        .risk-factor-impact.low {
            background-color: #dcedc8;
            color: #33691e;
        }
        
        .risk-recommendation {
            background-color: #f5f9ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .risk-recommendation h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #1565c0;
        }
        
        .admin-user-info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .admin-user-info-item {
            margin-bottom: 5px;
        }
        
        .admin-user-info-label {
            font-weight: 500;
            color: #455a64;
            display: block;
            margin-bottom: 3px;
        }
        
        .admin-verification-layout {
            display: flex;
            gap: 20px;
            flex-grow: 1;
            min-height: 0;
        }
        
        .admin-document-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        .admin-document-verification {
            flex-grow: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
        }
        
        .admin-document-preview {
            margin-bottom: 15px;
            flex-grow: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
        }
        
        .admin-document-preview h4 {
            margin: 0 0 10px;
            color: #1976d2;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .admin-image-controls {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .admin-image-control {
            padding: 5px 10px;
            border: 1px solid #e0e0e0;
            background-color: #f5f5f5;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .admin-image-control:hover {
            background-color: #e0e0e0;
        }
        
        .admin-image-container {
            position: relative;
            flex-grow: 1;
            min-height: 0;
            background-color: #f0f0f0;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .admin-document-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .admin-document-details {
            background-color: #f5f9fd;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .admin-document-details h4 {
            margin: 0 0 10px;
            color: #1976d2;
        }
        
        .admin-document-detail-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .admin-document-detail-item {
            margin-bottom: 5px;
        }
        
        .admin-document-detail-label {
            font-weight: 500;
            color: #455a64;
            display: block;
            margin-bottom: 3px;
        }
        
        .admin-verification-sidebar {
            width: 300px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            background-color: #f5f9fd;
            border-radius: 8px;
            padding: 15px;
        }
        
        .admin-verification-sidebar h4 {
            margin: 0 0 15px;
            color: #1976d2;
        }
        
        .admin-verification-notes {
            margin-bottom: 15px;
        }
        
        .admin-verification-history {
            flex-grow: 1;
            min-height: 0;
            overflow-y: auto;
        }
        
        .admin-history-item {
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .admin-history-item:last-child {
            border-bottom: none;
        }
        
        .admin-history-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #78909c;
            margin-bottom: 5px;
        }
        
        .admin-history-action {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .admin-history-action.approved {
            color: #2e7d32;
        }
        
        .admin-history-action.rejected {
            color: #c62828;
        }
        
        .admin-history-action.commented {
            color: #0d47a1;
        }
        
        .admin-history-action.flagged {
            color: #e65100;
        }
        
        .admin-history-content {
            font-size: 13px;
            line-height: 1.4;
            color: #37474f;
        }
        
        .admin-annotation-tool {
            margin-top: 15px;
        }
        
        .admin-annotation-tool h5 {
            margin: 0 0 10px;
            font-size: 14px;
            color: #455a64;
        }
        
        .admin-annotation-tools {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .admin-annotation-btn {
            padding: 5px 10px;
            background-color: #f5f5f5;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        
        .admin-annotation-btn:hover {
            background-color: #e0e0e0;
        }
        
        .admin-annotation-btn.active {
            background-color: #e3f2fd;
            border-color: #90caf9;
            color: #1976d2;
        }
        
        .admin-modal-form {
            margin-top: 20px;
        }
        
        .admin-form-group {
            margin-bottom: 15px;
        }
        
        .admin-form-label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #455a64;
        }
        
        .admin-form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
            resize: vertical;
        }
        
        .admin-form-input:focus {
            border-color: #90caf9;
            outline: none;
        }
        
        .admin-button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: background-color 0.2s ease;
        }
        
        .admin-button.icon {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .admin-button.primary {
            background-color: #1976d2;
            color: white;
        }
        
        .admin-button.primary:hover {
            background-color: #1565c0;
        }
        
        .admin-button.success {
            background-color: #2e7d32;
            color: white;
        }
        
        .admin-button.success:hover {
            background-color: #1b5e20;
        }
        
        .admin-button.danger {
            background-color: #c62828;
            color: white;
        }
        
        .admin-button.danger:hover {
            background-color: #b71c1c;
        }
        
        .admin-button.warning {
            background-color: #ff9800;
            color: white;
        }
        
        .admin-button.warning:hover {
            background-color: #f57c00;
        }
        
        .admin-button.secondary {
            background-color: #f5f5f5;
            color: #455a64;
        }
        
        .admin-button.secondary:hover {
            background-color: #e0e0e0;
        }
        
        .admin-no-data {
            padding: 50px 20px;
            text-align: center;
            color: #78909c;
            font-size: 16px;
        }
        
        .admin-stats-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .admin-chart {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            padding: 20px;
        }
        
        .admin-chart h3 {
            margin: 0 0 15px;
            font-size: 18px;
            color: #455a64;
        }
        
        .admin-chart-placeholder {
            height: 250px;
            background-color: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            color: #78909c;
        }
        
        .admin-risk-metrics {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            padding: 20px;
        }
        
        .admin-risk-metrics h3 {
            margin: 0 0 15px;
            font-size: 18px;
            color: #455a64;
        }
        
        .admin-risk-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .admin-risk-item:last-child {
            border-bottom: none;
        }
        
        .admin-risk-label {
            font-weight: 500;
            color: #455a64;
        }
        
        .admin-risk-value {
            font-weight: 500;
        }
        
        .admin-risk-value.high {
            color: #c62828;
        }
        
        .admin-risk-value.medium {
            color: #ff9800;
        }
        
        .admin-risk-value.low {
            color: #2e7d32;
        }
        
        @media (max-width: 1024px) {
            .admin-verification-layout {
                flex-direction: column;
            }
            
            .admin-verification-sidebar {
                width: 100%;
                margin-top: 20px;
            }
            
            .admin-stats-container {
                grid-template-columns: 1fr;
            }
            
            .admin-dashboard-summary {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .admin-user-info-grid,
            .admin-document-detail-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-pagination {
                flex-direction: column;
                gap: 10px;
                align-items: center;
            }
            
            .admin-dashboard-summary {
                grid-template-columns: 1fr;
            }
        }
        
        /* Styles pour les notifications */
        .admin-notification-center {
            position: relative;
            margin-left: 20px;
        }
        
        .notification-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            position: relative;
            padding: 5px;
            color: white;
        }
        
        .notification-icon {
            font-size: 1.4rem;
        }
        
        .notification-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ff3860;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .notification-panel {
            position: absolute;
            top: 100%;
            right: 0;
            width: 320px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
            overflow: hidden;
        }
        
        .notification-panel.active {
            display: block;
        }
        
        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background-color: #f5f5f5;
            border-bottom: 1px solid #ddd;
        }
        
        .notification-header h3 {
            margin: 0;
            font-size: 1rem;
        }
        
        .mark-all-read {
            background: none;
            border: none;
            color: #3273dc;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .notification-list {
            list-style: none;
            margin: 0;
            padding: 0;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .notification-item {
            padding: 10px 15px;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
        }
        
        .notification-item:last-child {
            border-bottom: none;
        }
        
        .notification-item.unread {
            background-color: #f0f7ff;
        }
        
        .notification-item:hover {
            background-color: #f5f5f5;
        }
        
        .notification-content {
            margin-bottom: 5px;
        }
        
        .notification-time {
            font-size: 0.7rem;
            color: #777;
        }
        
        .no-notifications {
            padding: 20px;
            text-align: center;
            color: #777;
        }
        
        /* Styles pour le graphique */
        .admin-chart-container {
            height: 300px;
            width: 100%;
            background-color: #fff;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .admin-chart-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .admin-mini-chart {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.07);
            padding: 15px;
            flex: 1;
            min-width: 0;
        }
        
        .admin-mini-chart-container {
            height: 200px;
            position: relative;
        }
        
        .admin-alert-system {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.07);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .admin-alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .admin-alert-title {
            font-size: 18px;
            font-weight: 500;
            color: #0d47a1;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .admin-alert-title .alert-icon {
            color: #f57c00;
        }
        
        .admin-alert-filters {
            display: flex;
            gap: 10px;
        }
        
        .admin-alert-filter {
            padding: 5px 10px;
            background-color: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .admin-alert-filter:hover, 
        .admin-alert-filter.active {
            background-color: #bbdefb;
            border-color: #90caf9;
        }
        
        .admin-alert-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .admin-alert-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s ease;
        }
        
        .admin-alert-item:hover {
            background-color: #f9f9f9;
        }
        
        .admin-alert-item:last-child {
            border-bottom: none;
        }
        
        .admin-alert-icon {
            flex-shrink: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #ffecb3;
            color: #ff8f00;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .admin-alert-icon.high {
            background-color: #ffcdd2;
            color: #c62828;
        }
        
        .admin-alert-icon.medium {
            background-color: #ffecb3;
            color: #ff8f00;
        }
        
        .admin-alert-icon.low {
            background-color: #dcedc8;
            color: #558b2f;
        }
        
        .admin-alert-content {
            flex-grow: 1;
            min-width: 0;
        }
        
        .admin-alert-content-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .admin-alert-name {
            font-weight: 500;
            color: #37474f;
        }
        
        .admin-alert-time {
            font-size: 13px;
            color: #78909c;
        }
        
        .admin-alert-message {
            font-size: 14px;
            color: #546e7a;
            margin-bottom: 5px;
        }
        
        .admin-alert-risk {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .admin-alert-risk-label {
            font-size: 12px;
            font-weight: 500;
            color: #78909c;
        }
        
        .admin-alert-risk-score {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .admin-alert-risk-score.high {
            background-color: #ffcdd2;
            color: #c62828;
        }
        
        .admin-alert-risk-score.medium {
            background-color: #ffecb3;
            color: #ff8f00;
        }
        
        .admin-alert-risk-score.low {
            background-color: #dcedc8;
            color: #558b2f;
        }
        
        .admin-alert-actions {
            display: flex;
            gap: 8px;
        }
        
        /* Style pour le lien de documentation API */
        .api-doc-link {
            background-color: #e53935;
            color: white !important;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .api-doc-link:hover {
            background-color: #c62828;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <h1>PACIFIQUE MS BINGO</h1>
            <nav>
                <ul>
                    <li><a href="/">Accueil</a></li>
                    <li><a href="/organizer.html">Administration</a></li>
                    <li><a href="/admin-kyc.html" class="active">V√©rification KYC</a></li>
                    <li><a href="/kyc-api-doc.html" target="_blank" class="api-doc-link">API Documentation</a></li>
                </ul>
            </nav>
            <div class="admin-notification-center">
                <button id="notification-button" class="notification-button">
                    <span class="notification-icon">üîî</span>
                    <span id="notification-count" class="notification-count">0</span>
                </button>
                <div id="notification-panel" class="notification-panel">
                    <div class="notification-header">
                        <h3>Notifications</h3>
                        <button id="mark-all-read" class="mark-all-read">Tout marquer comme lu</button>
                    </div>
                    <ul id="notification-list" class="notification-list">
                        <!-- Les notifications seront charg√©es ici -->
                    </ul>
                    <div id="no-notifications" class="no-notifications">
                        Aucune notification
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <main>
        <div class="admin-container">
            <div class="admin-header">
                <h1>Administration KYC</h1>
                <p>V√©rifiez et approuvez les documents d'identit√© soumis par les utilisateurs.</p>
            </div>
            
            <div class="admin-tabs">
                <button id="tab-dashboard" class="admin-tab active">Tableau de bord</button>
                <button id="tab-pending" class="admin-tab">Documents en attente</button>
                <button id="tab-flagged" class="admin-tab">Documents signal√©s</button>
                <button id="tab-history" class="admin-tab">Historique</button>
            </div>
            
            <!-- Tableau de bord -->
            <div id="dashboard-content" class="admin-tab-content active">
                <div class="admin-dashboard-summary">
                    <div class="admin-dashboard-card pending">
                        <div class="admin-dashboard-card-title">Documents en attente</div>
                        <div id="dashboard-pending-count" class="admin-dashboard-card-value">0</div>
                        <div class="admin-dashboard-card-trend up">
                            <span>+4%</span> depuis la semaine derni√®re
                        </div>
                    </div>
                    
                    <div class="admin-dashboard-card approved">
                        <div class="admin-dashboard-card-title">Documents approuv√©s (30j)</div>
                        <div id="dashboard-approved-count" class="admin-dashboard-card-value">0</div>
                        <div class="admin-dashboard-card-trend up">
                            <span>+12%</span> depuis la p√©riode pr√©c√©dente
                        </div>
                    </div>
                    
                    <div class="admin-dashboard-card rejected">
                        <div class="admin-dashboard-card-title">Documents refus√©s (30j)</div>
                        <div id="dashboard-rejected-count" class="admin-dashboard-card-value">0</div>
                        <div class="admin-dashboard-card-trend down">
                            <span>-5%</span> depuis la p√©riode pr√©c√©dente
                        </div>
                    </div>
                    
                    <div class="admin-dashboard-card processing-time">
                        <div class="admin-dashboard-card-title">Temps moyen de traitement</div>
                        <div id="dashboard-processing-time" class="admin-dashboard-card-value">8h</div>
                        <div class="admin-dashboard-card-trend down">
                            <span>-2h</span> depuis la p√©riode pr√©c√©dente
                        </div>
                    </div>
                </div>
                
                <div class="admin-stats-container">
                    <div class="admin-chart">
                        <h3>Volume de documents trait√©s (30 derniers jours)</h3>
                        <div id="documents-chart" class="admin-chart-container">
                            <canvas id="documentsVolumeChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="admin-risk-metrics">
                        <h3>Analyse des risques</h3>
                        <div class="admin-risk-item">
                            <div class="admin-risk-label">Documents √† risque √©lev√©</div>
                            <div class="admin-risk-value high" id="high-risk-count">5</div>
                        </div>
                        <div class="admin-risk-item">
                            <div class="admin-risk-label">Documents √† risque moyen</div>
                            <div class="admin-risk-value medium" id="medium-risk-count">12</div>
                        </div>
                        <div class="admin-risk-item">
                            <div class="admin-risk-label">Duplications potentielles</div>
                            <div class="admin-risk-value high" id="duplicate-count">3</div>
                        </div>
                        <div class="admin-risk-item">
                            <div class="admin-risk-label">Comptes multi-documents</div>
                            <div class="admin-risk-value medium" id="multi-doc-count">8</div>
                        </div>
                    </div>
                </div>
                
                <div class="admin-chart-row">
                    <div class="admin-mini-chart">
                        <h3>R√©partition par type de document</h3>
                        <div class="admin-mini-chart-container">
                            <canvas id="documentTypesChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="admin-mini-chart">
                        <h3>Temps de traitement moyen par type</h3>
                        <div class="admin-mini-chart-container">
                            <canvas id="processingTimeChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="admin-alert-system">
                    <div class="admin-alert-header">
                        <div class="admin-alert-title">
                            <span class="alert-icon">‚ö†Ô∏è</span>
                            Alertes et documents suspects
                        </div>
                        <div class="admin-alert-filters">
                            <div class="admin-alert-filter active" data-filter="all">Tous</div>
                            <div class="admin-alert-filter" data-filter="high">Risque √©lev√©</div>
                            <div class="admin-alert-filter" data-filter="medium">Risque moyen</div>
                            <div class="admin-alert-filter" data-filter="duplicate">Duplications</div>
                        </div>
                    </div>
                    
                    <div class="admin-alert-list" id="risk-alerts-list">
                        <!-- Les alertes seront g√©n√©r√©es ici -->
                    </div>
                </div>
                
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h2>Documents r√©cemment trait√©s</h2>
                    </div>
                    <div class="admin-card-body">
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Utilisateur</th>
                                        <th>Type de document</th>
                                        <th>Date de soumission</th>
                                        <th>Trait√© par</th>
                                        <th>Date de traitement</th>
                                        <th>Statut</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-documents-table-body">
                                    <!-- Les documents r√©cemment trait√©s seront charg√©s ici -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Documents en attente -->
            <div id="pending-content" class="admin-tab-content">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h2>Documents en attente de v√©rification</h2>
                        <span id="pending-count" class="badge">0</span>
                    </div>
                    <div class="admin-card-body">
                        <div class="admin-filters">
                            <div class="admin-filter-group">
                                <label class="admin-filter-label" for="filter-type">Type de document</label>
                                <select id="filter-type" class="admin-filter-input">
                                    <option value="">Tous les types</option>
                                    <option value="identity_card">Carte d'identit√©</option>
                                    <option value="passport">Passeport</option>
                                    <option value="driving_license">Permis de conduire</option>
                                    <option value="residence_proof">Justificatif de domicile</option>
                                    <option value="selfie">Selfie</option>
                                </select>
                            </div>
                            <div class="admin-filter-group">
                                <label class="admin-filter-label" for="filter-username">Nom d'utilisateur</label>
                                <input type="text" id="filter-username" class="admin-filter-input" placeholder="Rechercher...">
                            </div>
                            <div class="admin-filter-group">
                                <label class="admin-filter-label" for="filter-date">Date de soumission</label>
                                <input type="date" id="filter-date" class="admin-filter-input">
                            </div>
                            <div class="admin-filter-group">
                                <label class="admin-filter-label" for="filter-risk">Niveau de risque</label>
                                <select id="filter-risk" class="admin-filter-input">
                                    <option value="">Tous les niveaux</option>
                                    <option value="high">Risque √©lev√©</option>
                                    <option value="medium">Risque moyen</option>
                                    <option value="low">Risque faible</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Utilisateur</th>
                                        <th>Type de document</th>
                                        <th>Date de soumission</th>
                                        <th>Risque</th>
                                        <th>Statut</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="documents-table-body">
                                    <!-- Les documents seront charg√©s ici -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div id="no-documents" class="admin-no-data" style="display: none;">
                            Aucun document en attente de v√©rification.
                        </div>
                        
                        <div class="admin-pagination">
                            <div id="pagination-info" class="pagination-info">
                                Affichage de 0-0 sur 0 documents
                            </div>
                            <div class="pagination-buttons">
                                <button id="prev-page" class="pagination-button" disabled>&lt; Pr√©c√©dent</button>
                                <button id="next-page" class="pagination-button" disabled>Suivant &gt;</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Documents signal√©s -->
            <div id="flagged-content" class="admin-tab-content">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h2>Documents signal√©s</h2>
                        <span id="flagged-count" class="badge">0</span>
                    </div>
                    <div class="admin-card-body">
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Utilisateur</th>
                                        <th>Type de document</th>
                                        <th>Date de soumission</th>
                                        <th>Raison du signalement</th>
                                        <th>Signal√© par</th>
                                        <th>Date de signalement</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="flagged-documents-table-body">
                                    <!-- Les documents signal√©s seront charg√©s ici -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div id="no-flagged-documents" class="admin-no-data" style="display: none;">
                            Aucun document signal√©.
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Historique -->
            <div id="history-content" class="admin-tab-content">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <div class="admin-card-header-content">
                            <h2>Historique des v√©rifications</h2>
                            <div class="admin-card-actions">
                                <div class="export-dropdown">
                                    <button id="export-csv-btn" class="admin-button secondary small">
                                        <i class="fas fa-file-csv"></i> Exporter CSV
                                    </button>
                                    <div class="export-dropdown-content">
                                        <a href="#" id="export-csv-all">Tous les documents</a>
                                        <a href="#" id="export-csv-high-risk">Documents √† risque √©lev√©</a>
                                        <a href="#" id="export-csv-by-date">Par date</a>
                                        <a href="#" id="export-csv-by-user">Par utilisateur</a>
                                    </div>
                                </div>
                                <div class="export-dropdown">
                                    <button id="export-pdf-btn" class="admin-button secondary small">
                                        <i class="fas fa-file-pdf"></i> Exporter PDF
                                    </button>
                                    <div class="export-dropdown-content">
                                        <a href="#" id="export-pdf-all">Tous les documents</a>
                                        <a href="#" id="export-pdf-high-risk">Documents √† risque √©lev√©</a>
                                        <a href="#" id="export-pdf-by-date">Par date</a>
                                        <a href="#" id="export-pdf-by-user">Par utilisateur</a>
                                    </div>
                                </div>
                                <div class="export-dropdown">
                                    <button id="schedule-report-btn" class="admin-button primary small">
                                        <i class="fas fa-calendar-alt"></i> Rapports automatiques
                                    </button>
                                    <div class="export-dropdown-content">
                                        <a href="#" id="schedule-monthly">Rapport mensuel</a>
                                        <a href="#" id="schedule-weekly">Rapport hebdomadaire</a>
                                        <a href="#" id="schedule-daily">Rapport quotidien</a>
                                        <a href="#" id="schedule-manage">G√©rer les rapports</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="admin-card-body">
                        <div class="admin-filters">
                            <div class="admin-filter-group">
                                <label class="admin-filter-label" for="history-filter-user">Utilisateur</label>
                                <input type="text" id="history-filter-user" class="admin-filter-input" placeholder="Nom d'utilisateur...">
                            </div>
                            <div class="admin-filter-group">
                                <label class="admin-filter-label" for="history-filter-admin">Administrateur</label>
                                <input type="text" id="history-filter-admin" class="admin-filter-input" placeholder="Nom d'administrateur...">
                            </div>
                            <div class="admin-filter-group">
                                <label class="admin-filter-label" for="history-filter-action">Action</label>
                                <select id="history-filter-action" class="admin-filter-input">
                                    <option value="">Toutes les actions</option>
                                    <option value="approved">Approuv√©</option>
                                    <option value="rejected">Refus√©</option>
                                    <option value="flagged">Signal√©</option>
                                    <option value="commented">Comment√©</option>
                                </select>
                            </div>
                            <div class="admin-filter-group">
                                <label class="admin-filter-label" for="history-filter-date">P√©riode</label>
                                <select id="history-filter-date" class="admin-filter-input">
                                    <option value="7">7 derniers jours</option>
                                    <option value="30" selected>30 derniers jours</option>
                                    <option value="90">90 derniers jours</option>
                                    <option value="all">Tout l'historique</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Administrateur</th>
                                        <th>Action</th>
                                        <th>Utilisateur</th>
                                        <th>Document</th>
                                        <th>D√©tails</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="history-table-body">
                                    <!-- L'historique sera charg√© ici -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div id="no-history" class="admin-no-data" style="display: none;">
                            Aucun historique de v√©rification pour cette p√©riode.
                        </div>
                        
                        <div class="admin-pagination">
                            <div id="history-pagination-info" class="pagination-info">
                                Affichage de 0-0 sur 0 entr√©es
                            </div>
                            <div class="pagination-buttons">
                                <button id="history-prev-page" class="pagination-button" disabled>&lt; Pr√©c√©dent</button>
                                <button id="history-next-page" class="pagination-button" disabled>Suivant &gt;</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Modal de visualisation de document -->
    <div id="document-modal" class="admin-modal">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h3 id="modal-title">V√©rification de document</h3>
                <button id="modal-close" class="admin-modal-close">&times;</button>
            </div>
            <div class="admin-modal-body">
                <div class="admin-user-info">
                    <h4>
                        Informations utilisateur
                        <span id="risk-indicator" class="risk-indicator medium">Risque moyen</span>
                        <div id="risk-score-container" class="risk-score-container">
                            <div class="risk-score-gauge">
                                <div id="risk-score-fill" class="risk-score-fill" style="width: 65%;"></div>
                            </div>
                            <span id="risk-score-value" class="risk-score-value">65%</span>
                        </div>
                    </h4>
                    <div class="admin-user-info-grid">
                        <div class="admin-user-info-item">
                            <span class="admin-user-info-label">ID:</span>
                            <span id="user-id"></span>
                        </div>
                        <div class="admin-user-info-item">
                            <span class="admin-user-info-label">Nom d'utilisateur:</span>
                            <span id="user-username"></span>
                        </div>
                        <div class="admin-user-info-item">
                            <span class="admin-user-info-label">Email:</span>
                            <span id="user-email"></span>
                        </div>
                        <div class="admin-user-info-item">
                            <span class="admin-user-info-label">Date d'inscription:</span>
                            <span id="user-registration-date"></span>
                        </div>
                        <div class="admin-user-info-item">
                            <span class="admin-user-info-label">Pays:</span>
                            <span id="user-country"></span>
                        </div>
                        <div class="admin-user-info-item">
                            <span class="admin-user-info-label">Documents soumis:</span>
                            <span id="user-document-count"></span>
                        </div>
                        <div class="admin-user-info-item">
                            <span class="admin-user-info-label">Derni√®re connexion:</span>
                            <span id="user-last-login"></span>
                        </div>
                        <div class="admin-user-info-item">
                            <span class="admin-user-info-label">Adresse IP:</span>
                            <span id="user-ip"></span>
                        </div>
                        <div class="admin-user-info-item">
                            <span class="admin-user-info-label">Statut du compte:</span>
                            <span id="user-status"></span>
                        </div>
                    </div>
                </div>
                
                <div class="admin-verification-layout">
                    <div class="admin-document-column">
                        <div class="admin-document-verification">
                            <div class="admin-document-preview">
                                <h4>
                                    Aper√ßu du document
                                    <div class="admin-image-controls">
                                        <button class="admin-image-control" id="zoom-in">
                                            <span>Zoom +</span>
                                        </button>
                                        <button class="admin-image-control" id="zoom-out">
                                            <span>Zoom -</span>
                                        </button>
                                        <button class="admin-image-control" id="rotate-cw">
                                            <span>Rotation</span>
                                        </button>
                                        <button class="admin-image-control" id="enhance">
                                            <span>Am√©liorer</span>
                                        </button>
                                        <button class="admin-image-control" id="reset-image">
                                            <span>R√©initialiser</span>
                                        </button>
                                    </div>
                                </h4>
                                
                                <div class="admin-image-container">
                                    <img id="document-image" class="admin-document-image" src="/img/dummy-document.jpg" alt="Document">
                                </div>
                            </div>
                            
                            <div class="admin-document-details">
                                <h4>D√©tails du document</h4>
                                <div class="admin-document-detail-grid">
                                    <div class="admin-document-detail-item">
                                        <span class="admin-document-detail-label">ID du document:</span>
                                        <span id="document-id"></span>
                                    </div>
                                    <div class="admin-document-detail-item">
                                        <span class="admin-document-detail-label">Type:</span>
                                        <span id="document-type"></span>
                                    </div>
                                    <div class="admin-document-detail-item" style="grid-column: span 2;">
                                        <button id="view-risk-factors" class="admin-button warning" style="width: 100%;">
                                            Voir facteurs de risque
                                        </button>
                                    </div>
                                    <div class="admin-document-detail-item">
                                        <span class="admin-document-detail-label">Num√©ro:</span>
                                        <span id="document-number"></span>
                                    </div>
                                    <div class="admin-document-detail-item">
                                        <span class="admin-document-detail-label">Date d'expiration:</span>
                                        <span id="document-expiry"></span>
                                    </div>
                                    <div class="admin-document-detail-item">
                                        <span class="admin-document-detail-label">Pays:</span>
                                        <span id="document-country"></span>
                                    </div>
                                    <div class="admin-document-detail-item">
                                        <span class="admin-document-detail-label">Date de soumission:</span>
                                        <span id="document-upload-date"></span>
                                    </div>
                                    <div class="admin-document-detail-item">
                                        <span class="admin-document-detail-label">Format:</span>
                                        <span id="document-format"></span>
                                    </div>
                                    <div class="admin-document-detail-item">
                                        <span class="admin-document-detail-label">Taille:</span>
                                        <span id="document-size"></span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="admin-annotation-tool">
                                <h5>Outils d'annotation</h5>
                                <div class="admin-annotation-tools">
                                    <button class="admin-annotation-btn" id="tool-pointer">Pointer</button>
                                    <button class="admin-annotation-btn" id="tool-highlight">Surligner</button>
                                    <button class="admin-annotation-btn" id="tool-flag">Signaler</button>
                                    <button class="admin-annotation-btn" id="tool-measure">Mesurer</button>
                                    <button class="admin-annotation-btn" id="tool-clear">Effacer</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-verification-sidebar">
                        <h4>Historique et notes</h4>
                        
                        <div class="admin-verification-notes">
                            <div class="admin-form-group">
                                <label class="admin-form-label" for="verification-note">Ajouter une note</label>
                                <textarea id="verification-note" class="admin-form-input" rows="3" placeholder="Ajoutez une note ou un commentaire..."></textarea>
                                <button id="add-note-btn" class="admin-button primary" style="margin-top: 10px; width: 100%;">Ajouter</button>
                            </div>
                        </div>
                        
                        <div class="admin-verification-history">
                            <div class="admin-history-item">
                                <div class="admin-history-meta">
                                    <span>Aujourd'hui, 15:30</span>
                                    <span>admin-1</span>
                                </div>
                                <div class="admin-history-action flagged">
                                    Document signal√©
                                </div>
                                <div class="admin-history-content">
                                    La signature semble diff√©rente de celle sur les documents pr√©c√©dents.
                                </div>
                            </div>
                            
                            <div class="admin-history-item">
                                <div class="admin-history-meta">
                                    <span>Aujourd'hui, 14:22</span>
                                    <span>admin-2</span>
                                </div>
                                <div class="admin-history-action commented">
                                    Commentaire ajout√©
                                </div>
                                <div class="admin-history-content">
                                    Date de naissance diff√©rente de celle fournie lors de l'inscription.
                                </div>
                            </div>
                            
                            <div class="admin-history-item">
                                <div class="admin-history-meta">
                                    <span>Hier, 09:45</span>
                                    <span>system</span>
                                </div>
                                <div class="admin-history-action">
                                    Analyse automatique
                                </div>
                                <div class="admin-history-content">
                                    Risque moyen d√©tect√© - L'adresse IP de l'utilisateur provient d'un pays diff√©rent de celui indiqu√© dans le document.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="review-form" class="admin-modal-form">
                    <div class="admin-form-group">
                        <label class="admin-form-label" for="verification-decision">D√©cision finale</label>
                        <select id="verification-decision" class="admin-form-input">
                            <option value="approve">Approuver</option>
                            <option value="reject">Refuser</option>
                            <option value="flag">Signaler pour v√©rification suppl√©mentaire</option>
                        </select>
                    </div>
                    
                    <div class="admin-form-group" id="rejection-reason-group">
                        <label class="admin-form-label" for="rejection-reason">Raison du refus</label>
                        <textarea id="rejection-reason" class="admin-form-input" rows="3" placeholder="Entrez la raison du refus..."></textarea>
                    </div>
                    
                    <div class="admin-form-group" id="flag-reason-group" style="display: none;">
                        <label class="admin-form-label" for="flag-reason">Raison du signalement</label>
                        <textarea id="flag-reason" class="admin-form-input" rows="3" placeholder="Entrez la raison du signalement..."></textarea>
                    </div>
                </div>
            </div>
            <div class="admin-modal-footer">
                <button id="modal-close-btn" class="admin-button secondary">Fermer</button>
                <button id="flag-btn" class="admin-button warning">Signaler</button>
                <button id="reject-btn" class="admin-button danger">Refuser</button>
                <button id="approve-btn" class="admin-button success">Approuver</button>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <div class="footer-columns">
                <div class="footer-column">
                    <h3>√Ä propos</h3>
                    <p>PACIFIQUE MS BINGO est une plateforme de jeu en ligne certifi√©e offrant une exp√©rience de bingo √©quitable et s√©curis√©e.</p>
                </div>
                <div class="footer-column">
                    <h3>Administration</h3>
                    <ul>
                        <li><a href="/organizer.html">Tableau de bord</a></li>
                        <li><a href="/admin-kyc.html">V√©rification KYC</a></li>
                        <li><a href="/monitoring-dashboard.html">Surveillance</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Assistance</h3>
                    <ul>
                        <li><a href="#">Documentation</a></li>
                        <li><a href="#">Support</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 PACIFIQUE MS BINGO - Tous droits r√©serv√©s</p>
                <p>Licence ANJ en cours d'approbation</p>
            </div>
        </div>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // √âl√©ments des onglets
            const tabButtons = document.querySelectorAll('.admin-tab');
            const tabContents = document.querySelectorAll('.admin-tab-content');
            
            // Tableau de bord
            const dashboardPendingCount = document.getElementById('dashboard-pending-count');
            const dashboardApprovedCount = document.getElementById('dashboard-approved-count');
            const dashboardRejectedCount = document.getElementById('dashboard-rejected-count');
            const recentDocumentsTableBody = document.getElementById('recent-documents-table-body');
            
            // Documents en attente
            const documentsTableBody = document.getElementById('documents-table-body');
            const noDocumentsMsg = document.getElementById('no-documents');
            const pendingCountBadge = document.getElementById('pending-count');
            const paginationInfo = document.getElementById('pagination-info');
            const prevPageBtn = document.getElementById('prev-page');
            const nextPageBtn = document.getElementById('next-page');
            
            // Documents signal√©s
            const flaggedDocumentsTableBody = document.getElementById('flagged-documents-table-body');
            const flaggedCountBadge = document.getElementById('flagged-count');
            const noFlaggedDocumentsMsg = document.getElementById('no-flagged-documents');
            
            // Historique
            const historyTableBody = document.getElementById('history-table-body');
            const historyPaginationInfo = document.getElementById('history-pagination-info');
            const historyPrevPageBtn = document.getElementById('history-prev-page');
            const historyNextPageBtn = document.getElementById('history-next-page');
            
            // Filtres
            const filterType = document.getElementById('filter-type');
            const filterUsername = document.getElementById('filter-username');
            const filterDate = document.getElementById('filter-date');
            const filterRisk = document.getElementById('filter-risk');
            
            // Filtres d'historique
            const historyFilterUser = document.getElementById('history-filter-user');
            const historyFilterAdmin = document.getElementById('history-filter-admin');
            const historyFilterAction = document.getElementById('history-filter-action');
            const historyFilterDate = document.getElementById('history-filter-date');
            
            // Modal
            const documentModal = document.getElementById('document-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalClose = document.getElementById('modal-close');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const flagBtn = document.getElementById('flag-btn');
            const rejectBtn = document.getElementById('reject-btn');
            const approveBtn = document.getElementById('approve-btn');
            
            // S√©lecteur de d√©cision
            const verificationDecision = document.getElementById('verification-decision');
            const rejectionReasonGroup = document.getElementById('rejection-reason-group');
            const flagReasonGroup = document.getElementById('flag-reason-group');
            
            // Contr√¥les d'image
            const zoomInBtn = document.getElementById('zoom-in');
            const zoomOutBtn = document.getElementById('zoom-out');
            const rotateCwBtn = document.getElementById('rotate-cw');
            const enhanceBtn = document.getElementById('enhance');
            const resetImageBtn = document.getElementById('reset-image');
            
            // Outils d'annotation
            const annotationButtons = document.querySelectorAll('.admin-annotation-btn');
            
            // Notes
            const verificationNote = document.getElementById('verification-note');
            const addNoteBtn = document.getElementById('add-note-btn');
            
            // Champs du modal utilisateur
            const userId = document.getElementById('user-id');
            const userUsername = document.getElementById('user-username');
            const userEmail = document.getElementById('user-email');
            const userRegistrationDate = document.getElementById('user-registration-date');
            const userCountry = document.getElementById('user-country');
            const userDocumentCount = document.getElementById('user-document-count');
            const userLastLogin = document.getElementById('user-last-login');
            const userIp = document.getElementById('user-ip');
            const userStatus = document.getElementById('user-status');
            const riskIndicator = document.getElementById('risk-indicator');
            
            // Champs du modal document
            const documentImage = document.getElementById('document-image');
            const documentId = document.getElementById('document-id');
            const documentType = document.getElementById('document-type');
            const documentNumber = document.getElementById('document-number');
            const documentExpiry = document.getElementById('document-expiry');
            const documentCountry = document.getElementById('document-country');
            const documentUploadDate = document.getElementById('document-upload-date');
            const documentFormat = document.getElementById('document-format');
            const documentSize = document.getElementById('document-size');
            const rejectionReason = document.getElementById('rejection-reason');
            const flagReason = document.getElementById('flag-reason');
            
            // √âtat de l'application
            let currentPage = 1;
            let documentsPerPage = 10;
            let currentHistoryPage = 1;
            let historyPerPage = 10;
            let allDocuments = [];
            let filteredDocuments = [];
            let allFlaggedDocuments = [];
            let allHistory = [];
            let filteredHistory = [];
            let currentDocumentId = null;
            let currentImageZoom = 1;
            let currentImageRotation = 0;
            let activeAnnotationTool = null;
            
            // V√©rifier si l'utilisateur est administrateur
            checkAdminStatus();
            
            // Initialiser les onglets
            initTabs();
            
            // Initialiser le syst√®me de notification
            initNotificationSystem();
            
            // Charger les donn√©es initiales
            loadDashboardData();
            loadPendingDocuments();
            loadFlaggedDocuments();
            loadHistoryData();
            
            // Initialiser le graphique
            initDocumentsChart();
            
            // √âv√©nements pour les filtres
            filterType.addEventListener('change', applyFilters);
            filterUsername.addEventListener('input', applyFilters);
            filterDate.addEventListener('change', applyFilters);
            filterRisk.addEventListener('change', applyFilters);
            
            // √âv√©nements pour les filtres d'historique
            historyFilterUser.addEventListener('input', applyHistoryFilters);
            historyFilterAdmin.addEventListener('input', applyHistoryFilters);
            historyFilterAction.addEventListener('change', applyHistoryFilters);
            historyFilterDate.addEventListener('change', applyHistoryFilters);
            
            // √âv√©nements pour la pagination
            prevPageBtn.addEventListener('click', goToPreviousPage);
            nextPageBtn.addEventListener('click', goToNextPage);
            historyPrevPageBtn.addEventListener('click', goToPreviousHistoryPage);
            historyNextPageBtn.addEventListener('click', goToNextHistoryPage);
            
            // √âv√©nements pour le modal
            modalClose.addEventListener('click', closeModal);
            modalCloseBtn.addEventListener('click', closeModal);
            flagBtn.addEventListener('click', flagDocument);
            rejectBtn.addEventListener('click', rejectDocument);
            approveBtn.addEventListener('click', approveDocument);
            
            // √âv√©nement pour le s√©lecteur de d√©cision
            verificationDecision.addEventListener('change', updateDecisionForm);
            
            // √âv√©nements pour les contr√¥les d'image
            zoomInBtn.addEventListener('click', zoomIn);
            zoomOutBtn.addEventListener('click', zoomOut);
            rotateCwBtn.addEventListener('click', rotateImage);
            enhanceBtn.addEventListener('click', enhanceImage);
            resetImageBtn.addEventListener('click', resetImage);
            
            // √âv√©nements pour les outils d'annotation
            annotationButtons.forEach(button => {
                button.addEventListener('click', selectAnnotationTool);
            });
            
            // √âv√©nement pour ajouter une note
            addNoteBtn.addEventListener('click', addNote);
            
            // √âv√©nements pour l'export des donn√©es
            const exportCsvBtn = document.getElementById('export-csv-btn');
            const exportPdfBtn = document.getElementById('export-pdf-btn');
            const scheduleReportBtn = document.getElementById('schedule-report-btn');
            
            // √âv√©nements pour les sous-types d'export CSV
            document.getElementById('export-csv-all').addEventListener('click', () => exportHistoryToCSV('all'));
            document.getElementById('export-csv-high-risk').addEventListener('click', () => exportHistoryToCSV('high-risk'));
            document.getElementById('export-csv-by-date').addEventListener('click', () => exportHistoryToCSV('by-date'));
            document.getElementById('export-csv-by-user').addEventListener('click', () => exportHistoryToCSV('by-user'));
            
            // √âv√©nements pour les sous-types d'export PDF
            document.getElementById('export-pdf-all').addEventListener('click', () => exportHistoryToPDF('all'));
            document.getElementById('export-pdf-high-risk').addEventListener('click', () => exportHistoryToPDF('high-risk'));
            document.getElementById('export-pdf-by-date').addEventListener('click', () => exportHistoryToPDF('by-date'));
            document.getElementById('export-pdf-by-user').addEventListener('click', () => exportHistoryToPDF('by-user'));
            
            // √âv√©nements pour les rapports automatiques
            document.getElementById('schedule-monthly').addEventListener('click', () => scheduleReport('monthly'));
            document.getElementById('schedule-weekly').addEventListener('click', () => scheduleReport('weekly'));
            document.getElementById('schedule-daily').addEventListener('click', () => scheduleReport('daily'));
            document.getElementById('schedule-manage').addEventListener('click', showScheduledReports);
            
            // Boutons principaux d'export
            exportCsvBtn.addEventListener('click', () => exportHistoryToCSV('all'));
            exportPdfBtn.addEventListener('click', () => exportHistoryToPDF('all'));
            scheduleReportBtn.addEventListener('click', () => scheduleReport('monthly'));
            
            // √âv√©nements pour le modal des facteurs de risque
            const viewRiskFactorsBtn = document.getElementById('view-risk-factors');
            const riskFactorsCloseBtn = document.getElementById('risk-factors-close');
            const notifyRiskBtn = document.getElementById('notify-risk-btn');
            
            viewRiskFactorsBtn.addEventListener('click', openRiskFactorsModal);
            riskFactorsCloseBtn.addEventListener('click', closeRiskFactorsModal);
            
            notifyRiskBtn.addEventListener('click', function() {
                const currentDoc = allDocuments.find(doc => doc.id.toString() === currentDocumentId?.toString()) 
                    || allFlaggedDocuments.find(doc => doc.id.toString() === currentDocumentId?.toString());
                
                if (currentDoc) {
                    showNotification(
                        'Notification envoy√©e', 
                        `L'√©quipe de conformit√© a √©t√© notifi√©e du risque √©lev√© pour le document #${currentDoc.id} de l'utilisateur ${currentDoc.username}.`,
                        'success'
                    );
                }
                
                closeRiskFactorsModal();
            });
            
            /**
             * Initialise la navigation par onglets
             */
            function initTabs() {
                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        // Retirer la classe active de tous les onglets
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        tabContents.forEach(content => content.classList.remove('active'));
                        
                        // Ajouter la classe active √† l'onglet s√©lectionn√©
                        button.classList.add('active');
                        
                        // Afficher le contenu correspondant
                        const tabId = button.id.replace('tab-', '');
                        document.getElementById(`${tabId}-content`).classList.add('active');
                    });
                });
            }
            
            /**
             * Calcule le score de risque d'un document
             * @param {Object} document - Le document √† √©valuer
             * @returns {Object} R√©sultat avec score, niveau et facteurs
             */
            function calculateRiskScore(document) {
                // Tableau des facteurs de risque
                let factors = [];
                let totalRiskScore = 0;
                let totalFactors = 0;
                
                // 1. D√©tection d'expiration
                if (document.expiryDate) {
                    const today = new Date();
                    const expiry = new Date(document.expiryDate);
                    const monthsUntilExpiry = (expiry - today) / (1000 * 60 * 60 * 24 * 30);
                    
                    if (expiry < today) {
                        // Document expir√©
                        factors.push({
                            name: "Document expir√©",
                            impact: 1.0,
                            description: "Le document a d√©pass√© sa date d'expiration."
                        });
                        totalRiskScore += 1.0;
                        totalFactors++;
                    } else if (monthsUntilExpiry < 3) {
                        // Expire bient√¥t
                        factors.push({
                            name: "Expiration imminente",
                            impact: 0.5,
                            description: "Le document expire dans moins de 3 mois."
                        });
                        totalRiskScore += 0.5;
                        totalFactors++;
                    }
                }
                
                // 2. Analyse du pays d'origine
                if (document.country) {
                    // Liste de pays √† risque √©lev√© (pour d√©monstration)
                    const highRiskCountries = ['XX', 'YY', 'ZZ'];
                    const mediumRiskCountries = ['AA', 'BB', 'CC'];
                    
                    if (highRiskCountries.includes(document.country)) {
                        factors.push({
                            name: "Pays √† risque √©lev√©",
                            impact: 0.9,
                            description: "Le document provient d'une juridiction √† haut risque."
                        });
                        totalRiskScore += 0.9;
                        totalFactors++;
                    } else if (mediumRiskCountries.includes(document.country)) {
                        factors.push({
                            name: "Pays √† risque mod√©r√©",
                            impact: 0.5,
                            description: "Le document provient d'une juridiction √† risque mod√©r√©."
                        });
                        totalRiskScore += 0.5;
                        totalFactors++;
                    }
                }
                
                // 3. Analyse de l'adresse IP (si disponible)
                if (document.userIp) {
                    // Si l'IP est diff√©rente du pays du document
                    if (document.userCountry && document.country && 
                        document.userCountry !== document.country) {
                        factors.push({
                            name: "Incoh√©rence g√©ographique",
                            impact: 0.7,
                            description: "L'adresse IP et le pays du document ne correspondent pas."
                        });
                        totalRiskScore += 0.7;
                        totalFactors++;
                    }
                    
                    // Simulation de d√©tection de VPN/proxy
                    const isVPN = Math.random() < 0.2; // 20% de chance pour la d√©mo
                    if (isVPN) {
                        factors.push({
                            name: "Utilisation potentielle d'un VPN",
                            impact: 0.6,
                            description: "L'adresse IP est associ√©e √† un service de VPN ou proxy."
                        });
                        totalRiskScore += 0.6;
                        totalFactors++;
                    }
                }
                
                // 4. Nouveaut√© du compte
                if (document.userRegistrationDate) {
                    const registrationDate = new Date(document.userRegistrationDate);
                    const today = new Date();
                    const accountAgeDays = (today - registrationDate) / (1000 * 60 * 60 * 24);
                    
                    if (accountAgeDays < 7) {
                        factors.push({
                            name: "Compte r√©cent",
                            impact: 0.5,
                            description: "Le compte a √©t√© cr√©√© il y a moins de 7 jours."
                        });
                        totalRiskScore += 0.5;
                        totalFactors++;
                    }
                }
                
                // 5. Multiples tentatives de v√©rification (simulation)
                if (document.userDocumentCount && document.userDocumentCount > 2) {
                    factors.push({
                        name: "Multiples tentatives de v√©rification",
                        impact: 0.7,
                        description: `L'utilisateur a soumis ${document.userDocumentCount} documents diff√©rents.`
                    });
                    totalRiskScore += 0.7;
                    totalFactors++;
                }
                
                // 6. Analyse du type de fichier et de la taille
                if (document.fileFormat) {
                    // Format inhabituel
                    if (!['JPEG', 'PNG', 'PDF'].includes(document.fileFormat)) {
                        factors.push({
                            name: "Format de fichier inhabituel",
                            impact: 0.4,
                            description: `Format ${document.fileFormat} peu courant pour les documents d'identit√©.`
                        });
                        totalRiskScore += 0.4;
                        totalFactors++;
                    }
                    
                    // Taille suspicieuse
                    if (document.fileSize) {
                        const sizeInMB = parseFloat(document.fileSize.replace(' MB', ''));
                        if (sizeInMB < 0.1) {
                            factors.push({
                                name: "Taille de fichier suspecte",
                                impact: 0.5,
                                description: "Le fichier est anormalement petit pour un document d'identit√©."
                            });
                            totalRiskScore += 0.5;
                            totalFactors++;
                        } else if (sizeInMB > 10) {
                            factors.push({
                                name: "Taille de fichier suspecte",
                                impact: 0.3,
                                description: "Le fichier est anormalement volumineux pour un document d'identit√©."
                            });
                            totalRiskScore += 0.3;
                            totalFactors++;
                        }
                    }
                }
                
                // 7. Analyse du statut de l'utilisateur
                if (document.userStatus && document.userStatus !== 'Actif') {
                    factors.push({
                        name: "Compte √† statut sp√©cial",
                        impact: 0.6,
                        description: `Le compte a un statut ${document.userStatus}.`
                    });
                    totalRiskScore += 0.6;
                    totalFactors++;
                }
                
                // 8. D√©tection de doublons (simulation)
                const isDuplicate = document.documentNumber && Math.random() < 0.15; // 15% de chance pour la d√©mo
                if (isDuplicate) {
                    factors.push({
                        name: "Document potentiellement dupliqu√©",
                        impact: 0.8,
                        description: "Le num√©ro de document appara√Æt dans plusieurs comptes."
                    });
                    totalRiskScore += 0.8;
                    totalFactors++;
                }
                
                // 9. Respect du format attendu pour le num√©ro de document
                if (document.documentType === 'identity_card' && document.documentNumber) {
                    // V√©rifier si le format est standard pour une carte d'identit√©
                    const isValidFormat = /^[A-Z0-9]{8,12}$/.test(document.documentNumber);
                    if (!isValidFormat) {
                        factors.push({
                            name: "Format de num√©ro non standard",
                            impact: 0.4,
                            description: "Le num√©ro de document ne respecte pas le format attendu."
                        });
                        totalRiskScore += 0.4;
                        totalFactors++;
                    }
                }
                
                // 10. Risque pr√©d√©fini (si sp√©cifi√© dans le document)
                if (document.riskLevel) {
                    if (document.riskLevel === 'high') {
                        factors.push({
                            name: "Document pr√©c√©demment signal√©",
                            impact: 0.9,
                            description: "Ce document a d√©j√† √©t√© identifi√© comme √©tant √† risque √©lev√©."
                        });
                        totalRiskScore += 0.9;
                        totalFactors++;
                    } else if (document.riskLevel === 'medium') {
                        factors.push({
                            name: "Document pr√©c√©demment signal√©",
                            impact: 0.5,
                            description: "Ce document a d√©j√† √©t√© identifi√© comme √©tant √† risque mod√©r√©."
                        });
                        totalRiskScore += 0.5;
                        totalFactors++;
                    }
                }
                
                // Calcul du score final (moyenne pond√©r√©e)
                let finalScore = totalFactors > 0 ? totalRiskScore / totalFactors : 0;
                
                // Ajustement pour √©viter les scores trop √©lev√©s ou trop bas
                finalScore = Math.min(Math.max(finalScore, 0.1), 0.95);
                
                // D√©termination du niveau de risque
                let riskLevel = 'low';
                if (finalScore >= 0.7) {
                    riskLevel = 'high';
                } else if (finalScore >= 0.4) {
                    riskLevel = 'medium';
                }
                
                // Si aucun facteur n'a √©t√© identifi√©, ajouter un facteur par d√©faut
                if (factors.length === 0) {
                    factors.push({
                        name: "Aucun facteur de risque significatif",
                        impact: 0.1,
                        description: "Le document ne pr√©sente pas de facteurs de risque identifiables."
                    });
                }
                
                return {
                    score: finalScore,
                    level: riskLevel,
                    factors: factors
                };
            }
            
            /**
             * V√©rifie si l'utilisateur est administrateur
             */
            function checkAdminStatus() {
                // Pour le test, d√©sactiver temporairement la v√©rification d'authentification
                console.log('V√©rification d\'authentification d√©sactiv√©e pour le test');
                
                // V√©rifi√© si URL contient direct=true, dans ce cas on court-circuite l'authentification
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('direct') === 'true') {
                    console.log('Mode acc√®s direct activ√©');
                    return; // Ne pas v√©rifier l'authentification
                }
                
                // Code d'authentification normal, mais d√©sactiv√© pour le test
                /*
                fetch('/api/organizer/check-access')
                    .then(response => {
                        if (!response.ok) {
                            window.location.href = '/login.html?redirect=/organizer.html';
                            throw new Error('Non autoris√©');
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (!data.hasAccess) {
                            window.location.href = '/login.html?redirect=/organizer.html';
                        }
                    })
                    .catch(error => {
                        console.error('Erreur de v√©rification admin:', error);
                    });
                */
            }
            
            /**
             * Charge les donn√©es du tableau de bord
             */
            function loadDashboardData() {
                fetch('/api/kyc/admin/stats')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Erreur lors de la r√©cup√©ration des statistiques');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Mettre √† jour les compteurs
                        dashboardPendingCount.textContent = data.pendingCount || 0;
                        dashboardApprovedCount.textContent = data.approvedCount || 0;
                        dashboardRejectedCount.textContent = data.rejectedCount || 0;
                        
                        // Mettre √† jour les m√©triques de risque
                        document.getElementById('high-risk-count').textContent = data.highRiskCount || 0;
                        document.getElementById('medium-risk-count').textContent = data.mediumRiskCount || 0;
                        document.getElementById('duplicate-count').textContent = data.duplicateCount || 0;
                        document.getElementById('multi-doc-count').textContent = data.multiDocCount || 0;
                        
                        // Charger les documents r√©cemment trait√©s
                        const recentDocuments = data.recentDocuments || [];
                        renderRecentDocuments(recentDocuments);
                    })
                    .catch(error => {
                        console.error('Erreur de chargement des statistiques:', error);
                        // Pour la d√©mo, simuler des donn√©es
                        simulateDashboardData();
                    });
            }
            
            /**
             * Affiche les documents r√©cemment trait√©s
             * @param {Array} documents - Liste des documents r√©cents
             */
            function renderRecentDocuments(documents) {
                recentDocumentsTableBody.innerHTML = '';
                
                if (documents.length === 0) {
                    // Afficher un message si aucun document
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="8" class="admin-no-data">Aucun document r√©cent</td>`;
                    recentDocumentsTableBody.appendChild(row);
                    return;
                }
                
                // Afficher les documents r√©cents
                documents.forEach(doc => {
                    const row = document.createElement('tr');
                    
                    // Formater les dates
                    const uploadDate = new Date(doc.uploadDate).toLocaleDateString('fr-FR', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                    
                    const processDate = new Date(doc.processDate).toLocaleDateString('fr-FR', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    // Type de document format√©
                    let docTypeText = formatDocumentType(doc.documentType);
                    
                    // Statut format√©
                    let statusBadge = '';
                    if (doc.status === 'approved') {
                        statusBadge = `<span class="status-badge approved">Approuv√©</span>`;
                    } else if (doc.status === 'rejected') {
                        statusBadge = `<span class="status-badge rejected">Refus√©</span>`;
                    } else if (doc.status === 'flagged') {
                        statusBadge = `<span class="status-badge flagged">Signal√©</span>`;
                    }
                    
                    // Contenu HTML
                    row.innerHTML = `
                        <td>${doc.id}</td>
                        <td>${doc.username}</td>
                        <td>${docTypeText}</td>
                        <td>${uploadDate}</td>
                        <td>${doc.processedBy || 'N/A'}</td>
                        <td>${processDate}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-button view" data-document-id="${doc.id}">Voir</button>
                            </div>
                        </td>
                    `;
                    
                    recentDocumentsTableBody.appendChild(row);
                });
                
                // Attacher les √©v√©nements
                const viewButtons = recentDocumentsTableBody.querySelectorAll('.action-button.view');
                viewButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const docId = this.getAttribute('data-document-id');
                        openDocumentModal(docId);
                    });
                });
            }
            
            /**
             * Charge les documents en attente de v√©rification
             */
            function loadPendingDocuments() {
                fetch('/api/kyc/admin/pending')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Erreur lors de la r√©cup√©ration des documents');
                        }
                        return response.json();
                    })
                    .then(data => {
                        allDocuments = data.documents || [];
                        pendingCountBadge.textContent = allDocuments.length;
                        dashboardPendingCount.textContent = allDocuments.length;
                        
                        // Appliquer les filtres
                        applyFilters();
                    })
                    .catch(error => {
                        console.error('Erreur de chargement des documents:', error);
                        // Pour la d√©mo, simuler des documents
                        simulateDocuments();
                    });
            }
            
            /**
             * Charge les documents signal√©s
             */
            function loadFlaggedDocuments() {
                fetch('/api/kyc/admin/flagged')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Erreur lors de la r√©cup√©ration des documents signal√©s');
                        }
                        return response.json();
                    })
                    .then(data => {
                        allFlaggedDocuments = data.documents || [];
                        flaggedCountBadge.textContent = allFlaggedDocuments.length;
                        
                        renderFlaggedDocuments();
                    })
                    .catch(error => {
                        console.error('Erreur de chargement des documents signal√©s:', error);
                        // Pour la d√©mo, simuler des documents
                        simulateFlaggedDocuments();
                    });
            }
            
            /**
             * Affiche les documents signal√©s
             */
            function renderFlaggedDocuments() {
                flaggedDocumentsTableBody.innerHTML = '';
                
                if (allFlaggedDocuments.length === 0) {
                    noFlaggedDocumentsMsg.style.display = 'block';
                    return;
                }
                
                noFlaggedDocumentsMsg.style.display = 'none';
                
                // Afficher les documents signal√©s
                allFlaggedDocuments.forEach(doc => {
                    const row = document.createElement('tr');
                    
                    // Type de document format√©
                    let docTypeText = formatDocumentType(doc.documentType);
                    
                    // Formater les dates
                    const uploadDate = new Date(doc.uploadDate).toLocaleDateString('fr-FR', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                    
                    const flagDate = new Date(doc.flagDate).toLocaleDateString('fr-FR', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    // Contenu HTML
                    row.innerHTML = `
                        <td>${doc.id}</td>
                        <td>${doc.username}</td>
                        <td>${docTypeText}</td>
                        <td>${uploadDate}</td>
                        <td>${doc.flagReason || 'Non sp√©cifi√©'}</td>
                        <td>${doc.flaggedBy || 'Syst√®me'}</td>
                        <td>${flagDate}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-button view" data-document-id="${doc.id}">Voir</button>
                                <button class="action-button approve" data-document-id="${doc.id}">Approuver</button>
                                <button class="action-button reject" data-document-id="${doc.id}">Refuser</button>
                            </div>
                        </td>
                    `;
                    
                    flaggedDocumentsTableBody.appendChild(row);
                });
                
                // Attacher les √©v√©nements
                const viewButtons = flaggedDocumentsTableBody.querySelectorAll('.action-button.view');
                viewButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const docId = this.getAttribute('data-document-id');
                        openDocumentModal(docId);
                    });
                });
                
                const approveButtons = flaggedDocumentsTableBody.querySelectorAll('.action-button.approve');
                approveButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const docId = this.getAttribute('data-document-id');
                        openDocumentModal(docId, 'approve');
                    });
                });
                
                const rejectButtons = flaggedDocumentsTableBody.querySelectorAll('.action-button.reject');
                rejectButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const docId = this.getAttribute('data-document-id');
                        openDocumentModal(docId, 'reject');
                    });
                });
            }
            
            /**
             * Charge l'historique des v√©rifications
             */
            function loadHistoryData() {
                fetch('/api/kyc/admin/history')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Erreur lors de la r√©cup√©ration de l\'historique');
                        }
                        return response.json();
                    })
                    .then(data => {
                        allHistory = data.entries || [];
                        applyHistoryFilters();
                    })
                    .catch(error => {
                        console.error('Erreur de chargement de l\'historique:', error);
                        // Pour la d√©mo, simuler des donn√©es
                        simulateHistoryData();
                    });
            }
            
            /**
             * Applique les filtres d'historique
             */
            function applyHistoryFilters() {
                const userFilter = historyFilterUser.value.toLowerCase();
                const adminFilter = historyFilterAdmin.value.toLowerCase();
                const actionFilter = historyFilterAction.value;
                const dateFilter = parseInt(historyFilterDate.value);
                
                // Filtrer les entr√©es d'historique
                filteredHistory = allHistory.filter(entry => {
                    let matchesUser = true;
                    let matchesAdmin = true;
                    let matchesAction = true;
                    let matchesDate = true;
                    
                    if (userFilter && !entry.username.toLowerCase().includes(userFilter)) {
                        matchesUser = false;
                    }
                    
                    if (adminFilter && !entry.admin.toLowerCase().includes(adminFilter)) {
                        matchesAdmin = false;
                    }
                    
                    if (actionFilter && entry.action !== actionFilter) {
                        matchesAction = false;
                    }
                    
                    if (dateFilter && dateFilter !== 'all') {
                        const entryDate = new Date(entry.date);
                        const cutoffDate = new Date();
                        cutoffDate.setDate(cutoffDate.getDate() - dateFilter);
                        
                        if (entryDate < cutoffDate) {
                            matchesDate = false;
                        }
                    }
                    
                    return matchesUser && matchesAdmin && matchesAction && matchesDate;
                });
                
                // R√©initialiser la pagination
                currentHistoryPage = 1;
                
                // Mettre √† jour l'affichage
                renderHistory();
                updateHistoryPagination();
            }
            
            /**
             * Affiche l'historique des v√©rifications
             */
            function renderHistory() {
                historyTableBody.innerHTML = '';
                
                const startIndex = (currentHistoryPage - 1) * historyPerPage;
                const endIndex = Math.min(startIndex + historyPerPage, filteredHistory.length);
                
                if (filteredHistory.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="7" class="admin-no-data">Aucun historique correspondant aux crit√®res</td>`;
                    historyTableBody.appendChild(row);
                    return;
                }
                
                // Afficher les entr√©es d'historique
                for (let i = startIndex; i < endIndex; i++) {
                    const entry = filteredHistory[i];
                    const row = document.createElement('tr');
                    
                    // Formater la date
                    const date = new Date(entry.date).toLocaleDateString('fr-FR', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    // Action format√©e
                    let actionText = '';
                    let actionClass = '';
                    
                    switch (entry.action) {
                        case 'approved':
                            actionText = 'Approuv√©';
                            actionClass = 'approved';
                            break;
                        case 'rejected':
                            actionText = 'Refus√©';
                            actionClass = 'rejected';
                            break;
                        case 'flagged':
                            actionText = 'Signal√©';
                            actionClass = 'flagged';
                            break;
                        case 'commented':
                            actionText = 'Comment√©';
                            actionClass = 'commented';
                            break;
                        default:
                            actionText = entry.action;
                    }
                    
                    // Contenu HTML
                    row.innerHTML = `
                        <td>${date}</td>
                        <td>${entry.admin}</td>
                        <td><span class="status-badge ${actionClass}">${actionText}</span></td>
                        <td>${entry.username}</td>
                        <td>${formatDocumentType(entry.documentType)}</td>
                        <td>${entry.details || '-'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-button view" data-document-id="${entry.documentId}">Voir</button>
                            </div>
                        </td>
                    `;
                    
                    historyTableBody.appendChild(row);
                }
                
                // Attacher les √©v√©nements
                const viewButtons = historyTableBody.querySelectorAll('.action-button.view');
                viewButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const docId = this.getAttribute('data-document-id');
                        openDocumentModal(docId);
                    });
                });
            }
            
            /**
             * Met √† jour la pagination de l'historique
             */
            function updateHistoryPagination() {
                const totalPages = Math.ceil(filteredHistory.length / historyPerPage);
                const startIndex = (currentHistoryPage - 1) * historyPerPage + 1;
                const endIndex = Math.min(startIndex + historyPerPage - 1, filteredHistory.length);
                
                // Mettre √† jour le texte d'information
                if (filteredHistory.length === 0) {
                    historyPaginationInfo.textContent = 'Aucune entr√©e';
                } else {
                    historyPaginationInfo.textContent = `Affichage de ${startIndex}-${endIndex} sur ${filteredHistory.length} entr√©es`;
                }
                
                // Activer/d√©sactiver les boutons de pagination
                historyPrevPageBtn.disabled = currentHistoryPage <= 1;
                historyNextPageBtn.disabled = currentHistoryPage >= totalPages;
            }
            
            /**
             * Passe √† la page pr√©c√©dente de l'historique
             */
            function goToPreviousHistoryPage() {
                if (currentHistoryPage > 1) {
                    currentHistoryPage--;
                    renderHistory();
                    updateHistoryPagination();
                }
            }
            
            /**
             * Passe √† la page suivante de l'historique
             */
            function goToNextHistoryPage() {
                const totalPages = Math.ceil(filteredHistory.length / historyPerPage);
                if (currentHistoryPage < totalPages) {
                    currentHistoryPage++;
                    renderHistory();
                    updateHistoryPagination();
                }
            }
            
            /**
             * Applique les filtres aux documents en attente
             */
            function applyFilters() {
                const typeFilter = filterType.value;
                const usernameFilter = filterUsername.value.toLowerCase();
                const dateFilter = filterDate.value;
                const riskFilter = filterRisk.value;
                
                // Filtrer les documents
                filteredDocuments = allDocuments.filter(doc => {
                    let matchesType = true;
                    let matchesUsername = true;
                    let matchesDate = true;
                    let matchesRisk = true;
                    
                    if (typeFilter && doc.documentType !== typeFilter) {
                        matchesType = false;
                    }
                    
                    if (usernameFilter && !doc.username.toLowerCase().includes(usernameFilter)) {
                        matchesUsername = false;
                    }
                    
                    if (dateFilter) {
                        const uploadDate = new Date(doc.uploadDate).toISOString().split('T')[0];
                        if (uploadDate !== dateFilter) {
                            matchesDate = false;
                        }
                    }
                    
                    if (riskFilter && doc.riskLevel !== riskFilter) {
                        matchesRisk = false;
                    }
                    
                    return matchesType && matchesUsername && matchesDate && matchesRisk;
                });
                
                // R√©initialiser la pagination
                currentPage = 1;
                
                // Mettre √† jour l'affichage
                renderDocuments();
                updatePagination();
            }
            
            /**
             * Affiche les documents filtr√©s
             */
            function renderDocuments() {
                // Vider le conteneur
                documentsTableBody.innerHTML = '';
                
                // Calculer les indices de d√©but et de fin
                const startIndex = (currentPage - 1) * documentsPerPage;
                const endIndex = Math.min(startIndex + documentsPerPage, filteredDocuments.length);
                
                // V√©rifier s'il y a des documents √† afficher
                if (filteredDocuments.length === 0) {
                    noDocumentsMsg.style.display = 'block';
                    return;
                }
                
                noDocumentsMsg.style.display = 'none';
                
                // Afficher les documents de la page actuelle
                for (let i = startIndex; i < endIndex; i++) {
                    const doc = filteredDocuments[i];
                    
                    // Cr√©er la ligne du tableau
                    const row = document.createElement('tr');
                    
                    // Ajouter une classe de risque si n√©cessaire
                    if (doc.riskLevel === 'high') {
                        row.classList.add('high-risk');
                    } else if (doc.riskLevel === 'medium') {
                        row.classList.add('medium-risk');
                    }
                    
                    // Type de document format√©
                    let docTypeText = formatDocumentType(doc.documentType);
                    
                    // Formater la date
                    const uploadDate = new Date(doc.uploadDate).toLocaleDateString('fr-FR', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    // Indicateur de risque
                    let riskBadge = '';
                    if (doc.riskLevel === 'high') {
                        riskBadge = '<span class="status-badge rejected">√âlev√©</span>';
                    } else if (doc.riskLevel === 'medium') {
                        riskBadge = '<span class="status-badge pending">Moyen</span>';
                    } else {
                        riskBadge = '<span class="status-badge approved">Faible</span>';
                    }
                    
                    // Contenu HTML
                    row.innerHTML = `
                        <td>${doc.id}</td>
                        <td>${doc.username}</td>
                        <td>${docTypeText}</td>
                        <td>${uploadDate}</td>
                        <td>${riskBadge}</td>
                        <td><span class="status-badge pending">En attente</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-button view" data-document-id="${doc.id}">Voir</button>
                                <button class="action-button approve" data-document-id="${doc.id}">Approuver</button>
                                <button class="action-button reject" data-document-id="${doc.id}">Refuser</button>
                                <button class="action-button flag" data-document-id="${doc.id}">Signaler</button>
                            </div>
                        </td>
                    `;
                    
                    // Ajouter la ligne au tableau
                    documentsTableBody.appendChild(row);
                }
                
                // Attacher les √©v√©nements aux boutons
                attachButtonEvents();
            }
            
            /**
             * Attache les √©v√©nements aux boutons d'action
             */
            function attachButtonEvents() {
                // Boutons de visualisation
                const viewButtons = documentsTableBody.querySelectorAll('.action-button.view');
                viewButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const docId = this.getAttribute('data-document-id');
                        openDocumentModal(docId);
                    });
                });
                
                // Boutons d'approbation
                const approveButtons = documentsTableBody.querySelectorAll('.action-button.approve');
                approveButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const docId = this.getAttribute('data-document-id');
                        openDocumentModal(docId, 'approve');
                    });
                });
                
                // Boutons de refus
                const rejectButtons = documentsTableBody.querySelectorAll('.action-button.reject');
                rejectButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const docId = this.getAttribute('data-document-id');
                        openDocumentModal(docId, 'reject');
                    });
                });
                
                // Boutons de signalement
                const flagButtons = documentsTableBody.querySelectorAll('.action-button.flag');
                flagButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const docId = this.getAttribute('data-document-id');
                        openDocumentModal(docId, 'flag');
                    });
                });
            }
            
            /**
             * Met √† jour l'affichage de la pagination
             */
            function updatePagination() {
                const totalPages = Math.ceil(filteredDocuments.length / documentsPerPage);
                const startIndex = (currentPage - 1) * documentsPerPage + 1;
                const endIndex = Math.min(startIndex + documentsPerPage - 1, filteredDocuments.length);
                
                // Mettre √† jour le texte d'information
                if (filteredDocuments.length === 0) {
                    paginationInfo.textContent = 'Aucun document';
                } else {
                    paginationInfo.textContent = `Affichage de ${startIndex}-${endIndex} sur ${filteredDocuments.length} documents`;
                }
                
                // Activer/d√©sactiver les boutons de pagination
                prevPageBtn.disabled = currentPage <= 1;
                nextPageBtn.disabled = currentPage >= totalPages;
            }
            
            /**
             * Passe √† la page pr√©c√©dente
             */
            function goToPreviousPage() {
                if (currentPage > 1) {
                    currentPage--;
                    renderDocuments();
                    updatePagination();
                }
            }
            
            /**
             * Passe √† la page suivante
             */
            function goToNextPage() {
                const totalPages = Math.ceil(filteredDocuments.length / documentsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    renderDocuments();
                    updatePagination();
                }
            }
            
            /**
             * Ouvre le modal de document avec les d√©tails
             * @param {string} docId - ID du document
             * @param {string} action - Action √† effectuer (view, approve, reject, flag)
             */
            function openDocumentModal(docId, action = 'view') {
                // Trouver le document dans la liste
                let document = allDocuments.find(doc => doc.id.toString() === docId.toString());
                
                // Si pas trouv√© dans les documents en attente, chercher dans les documents signal√©s
                if (!document) {
                    document = allFlaggedDocuments.find(doc => doc.id.toString() === docId.toString());
                }
                
                if (!document) {
                    console.error(`Document non trouv√©: ${docId}`);
                    return;
                }
                
                currentDocumentId = docId;
                
                // Remplir les informations utilisateur
                userId.textContent = document.userId;
                userUsername.textContent = document.username;
                userEmail.textContent = document.email;
                userRegistrationDate.textContent = document.userRegistrationDate ? new Date(document.userRegistrationDate).toLocaleDateString('fr-FR') : 'N/A';
                userCountry.textContent = document.userCountry || 'N/A';
                userDocumentCount.textContent = document.userDocumentCount || '1';
                userLastLogin.textContent = document.userLastLogin ? new Date(document.userLastLogin).toLocaleDateString('fr-FR', { hour: '2-digit', minute: '2-digit' }) : 'N/A';
                userIp.textContent = document.userIp || 'N/A';
                userStatus.textContent = document.userStatus || 'Actif';
                
                // Calcul et affichage du score de risque
                const riskScoreResult = calculateRiskScore(document);
                const { score, level, factors } = riskScoreResult;
                
                // Formatage du score en pourcentage
                const scorePercent = Math.round(score * 100);
                
                // Mise √† jour de l'indicateur de risque
                riskIndicator.className = 'risk-indicator';
                if (level === 'high') {
                    riskIndicator.classList.add('high');
                    riskIndicator.textContent = 'Risque √©lev√©';
                } else if (level === 'medium') {
                    riskIndicator.classList.add('medium');
                    riskIndicator.textContent = 'Risque moyen';
                } else {
                    riskIndicator.classList.add('low');
                    riskIndicator.textContent = 'Risque faible';
                }
                
                // Mise √† jour de la jauge de risque
                const riskScoreFill = document.getElementById('risk-score-fill');
                const riskScoreValue = document.getElementById('risk-score-value');
                riskScoreFill.style.width = `${scorePercent}%`;
                riskScoreValue.textContent = `${scorePercent}%`;
                
                // Remplir les informations du document
                documentId.textContent = document.id;
                documentType.textContent = formatDocumentType(document.documentType);
                documentNumber.textContent = document.documentNumber || 'Non sp√©cifi√©';
                documentExpiry.textContent = document.expiryDate ? new Date(document.expiryDate).toLocaleDateString('fr-FR') : 'Non sp√©cifi√©';
                documentCountry.textContent = document.country || 'Non sp√©cifi√©';
                documentFormat.textContent = document.fileFormat || getFileFormat(document.filePath);
                documentSize.textContent = document.fileSize || 'N/A';
                
                // Formater la date
                const uploadDate = new Date(document.uploadDate).toLocaleDateString('fr-FR', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                documentUploadDate.textContent = uploadDate;
                
                // Charger l'image du document
                documentImage.src = `/uploads/kyc/${document.filePath}`;
                documentImage.onerror = function() {
                    documentImage.src = '/img/dummy-document.jpg';
                };
                
                // R√©initialiser l'image
                resetImage();
                
                // Pr√©parer le formulaire de d√©cision
                updateDecisionForm();
                
                // Pr√©parer le modal selon l'action
                if (action === 'approve') {
                    verificationDecision.value = 'approve';
                    updateDecisionForm();
                    modalTitle.textContent = 'Approuver le document';
                } else if (action === 'reject') {
                    verificationDecision.value = 'reject';
                    updateDecisionForm();
                    modalTitle.textContent = 'Refuser le document';
                } else if (action === 'flag') {
                    verificationDecision.value = 'flag';
                    updateDecisionForm();
                    modalTitle.textContent = 'Signaler le document';
                } else {
                    verificationDecision.value = 'approve';
                    updateDecisionForm();
                    modalTitle.textContent = 'V√©rification de document';
                }
                
                // Afficher le modal
                documentModal.classList.add('active');
            }
            
            /**
             * Ferme le modal de document
             */
            function closeModal() {
                documentModal.classList.remove('active');
                currentDocumentId = null;
            }
            
            /**
             * Met √† jour le formulaire de d√©cision en fonction de la s√©lection
             */
            function updateDecisionForm() {
                const decision = verificationDecision.value;
                
                // Masquer/afficher les champs pertinents
                rejectionReasonGroup.style.display = decision === 'reject' ? 'block' : 'none';
                flagReasonGroup.style.display = decision === 'flag' ? 'block' : 'none';
                
                // Mettre √† jour les boutons
                approveBtn.style.display = decision === 'approve' ? 'block' : 'none';
                rejectBtn.style.display = decision === 'reject' ? 'block' : 'none';
                flagBtn.style.display = decision === 'flag' ? 'block' : 'none';
            }
            
            /**
             * Approuve un document
             */
            function approveDocument() {
                if (!currentDocumentId) return;
                
                // D√©sactiver le bouton pendant le traitement
                approveBtn.disabled = true;
                approveBtn.textContent = 'Traitement...';
                
                // Envoyer la requ√™te d'approbation
                fetch('/api/kyc/admin/review', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        documentId: currentDocumentId,
                        action: 'approve',
                        note: verificationNote.value
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur lors de l\'approbation du document');
                    }
                    return response.json();
                })
                .then(data => {
                    // Fermer le modal
                    closeModal();
                    
                    // Recharger les donn√©es
                    loadDashboardData();
                    loadPendingDocuments();
                    loadFlaggedDocuments();
                    loadHistoryData();
                })
                .catch(error => {
                    console.error('Erreur d\'approbation:', error);
                    alert('Erreur lors de l\'approbation du document. Veuillez r√©essayer.');
                    
                    // Pour la d√©mo, simuler un succ√®s
                    closeModal();
                    loadDashboardData();
                    loadPendingDocuments();
                    loadFlaggedDocuments();
                    loadHistoryData();
                })
                .finally(() => {
                    // R√©activer le bouton
                    approveBtn.disabled = false;
                    approveBtn.textContent = 'Approuver';
                });
            }
            
            /**
             * Rejette un document
             */
            function rejectDocument() {
                if (!currentDocumentId) return;
                
                // V√©rifier si une raison a √©t√© fournie
                if (!rejectionReason.value.trim()) {
                    alert('Veuillez indiquer une raison pour le refus.');
                    rejectionReason.focus();
                    return;
                }
                
                // D√©sactiver le bouton pendant le traitement
                rejectBtn.disabled = true;
                rejectBtn.textContent = 'Traitement...';
                
                // Envoyer la requ√™te de rejet
                fetch('/api/kyc/admin/review', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        documentId: currentDocumentId,
                        action: 'reject',
                        reason: rejectionReason.value,
                        note: verificationNote.value
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur lors du rejet du document');
                    }
                    return response.json();
                })
                .then(data => {
                    // Fermer le modal
                    closeModal();
                    
                    // Recharger les donn√©es
                    loadDashboardData();
                    loadPendingDocuments();
                    loadFlaggedDocuments();
                    loadHistoryData();
                })
                .catch(error => {
                    console.error('Erreur de rejet:', error);
                    alert('Erreur lors du rejet du document. Veuillez r√©essayer.');
                    
                    // Pour la d√©mo, simuler un succ√®s
                    closeModal();
                    loadDashboardData();
                    loadPendingDocuments();
                    loadFlaggedDocuments();
                    loadHistoryData();
                })
                .finally(() => {
                    // R√©activer le bouton
                    rejectBtn.disabled = false;
                    rejectBtn.textContent = 'Refuser';
                });
            }
            
            /**
             * Signale un document pour v√©rification suppl√©mentaire
             */
            function flagDocument() {
                if (!currentDocumentId) return;
                
                // V√©rifier si une raison a √©t√© fournie
                if (!flagReason.value.trim()) {
                    alert('Veuillez indiquer une raison pour le signalement.');
                    flagReason.focus();
                    return;
                }
                
                // D√©sactiver le bouton pendant le traitement
                flagBtn.disabled = true;
                flagBtn.textContent = 'Traitement...';
                
                // Envoyer la requ√™te de signalement
                fetch('/api/kyc/admin/review', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        documentId: currentDocumentId,
                        action: 'flag',
                        reason: flagReason.value,
                        note: verificationNote.value
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur lors du signalement du document');
                    }
                    return response.json();
                })
                .then(data => {
                    // Fermer le modal
                    closeModal();
                    
                    // Recharger les donn√©es
                    loadDashboardData();
                    loadPendingDocuments();
                    loadFlaggedDocuments();
                    loadHistoryData();
                })
                .catch(error => {
                    console.error('Erreur de signalement:', error);
                    alert('Erreur lors du signalement du document. Veuillez r√©essayer.');
                    
                    // Pour la d√©mo, simuler un succ√®s
                    closeModal();
                    loadDashboardData();
                    loadPendingDocuments();
                    loadFlaggedDocuments();
                    loadHistoryData();
                })
                .finally(() => {
                    // R√©activer le bouton
                    flagBtn.disabled = false;
                    flagBtn.textContent = 'Signaler';
                });
            }
            
            /**
             * Ajoute une note au document
             */
            function addNote() {
                if (!currentDocumentId || !verificationNote.value.trim()) {
                    return;
                }
                
                // D√©sactiver le bouton pendant le traitement
                addNoteBtn.disabled = true;
                addNoteBtn.textContent = 'Envoi...';
                
                // Envoyer la requ√™te d'ajout de note
                fetch('/api/kyc/admin/note', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        documentId: currentDocumentId,
                        note: verificationNote.value
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur lors de l\'ajout de la note');
                    }
                    return response.json();
                })
                .then(data => {
                    // Ajouter la note √† l'historique de v√©rification
                    const historyItem = document.createElement('div');
                    historyItem.className = 'admin-history-item';
                    
                    const now = new Date();
                    const formattedTime = now.toLocaleTimeString('fr-FR', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    historyItem.innerHTML = `
                        <div class="admin-history-meta">
                            <span>Aujourd'hui, ${formattedTime}</span>
                            <span>admin</span>
                        </div>
                        <div class="admin-history-action commented">
                            Note ajout√©e
                        </div>
                        <div class="admin-history-content">
                            ${verificationNote.value}
                        </div>
                    `;
                    
                    // Ajouter au d√©but de l'historique
                    const historyContainer = document.querySelector('.admin-verification-history');
                    historyContainer.prepend(historyItem);
                    
                    // Effacer le champ de note
                    verificationNote.value = '';
                })
                .catch(error => {
                    console.error('Erreur d\'ajout de note:', error);
                    
                    // Pour la d√©mo, simuler un succ√®s
                    const historyItem = document.createElement('div');
                    historyItem.className = 'admin-history-item';
                    
                    const now = new Date();
                    const formattedTime = now.toLocaleTimeString('fr-FR', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    historyItem.innerHTML = `
                        <div class="admin-history-meta">
                            <span>Aujourd'hui, ${formattedTime}</span>
                            <span>admin</span>
                        </div>
                        <div class="admin-history-action commented">
                            Note ajout√©e
                        </div>
                        <div class="admin-history-content">
                            ${verificationNote.value}
                        </div>
                    `;
                    
                    // Ajouter au d√©but de l'historique
                    const historyContainer = document.querySelector('.admin-verification-history');
                    historyContainer.prepend(historyItem);
                    
                    // Effacer le champ de note
                    verificationNote.value = '';
                })
                .finally(() => {
                    // R√©activer le bouton
                    addNoteBtn.disabled = false;
                    addNoteBtn.textContent = 'Ajouter';
                });
            }
            
            /**
             * Zoom avant sur l'image
             */
            function zoomIn() {
                if (currentImageZoom < 3) {
                    currentImageZoom += 0.2;
                    updateImageTransform();
                }
            }
            
            /**
             * Zoom arri√®re sur l'image
             */
            function zoomOut() {
                if (currentImageZoom > 0.5) {
                    currentImageZoom -= 0.2;
                    updateImageTransform();
                }
            }
            
            /**
             * Fait pivoter l'image
             */
            function rotateImage() {
                currentImageRotation = (currentImageRotation + 90) % 360;
                updateImageTransform();
            }
            
            /**
             * Am√©liore la qualit√© de l'image (simul√©)
             */
            function enhanceImage() {
                // Simulation d'am√©lioration d'image
                enhanceBtn.textContent = 'Am√©lioration...';
                enhanceBtn.disabled = true;
                
                setTimeout(() => {
                    // Simuler un ajustement de contraste/luminosit√©
                    documentImage.style.filter = 'contrast(1.2) brightness(1.1)';
                    enhanceBtn.textContent = 'Am√©liorer';
                    enhanceBtn.disabled = false;
                }, 1000);
            }
            
            /**
             * R√©initialise l'image
             */
            function resetImage() {
                currentImageZoom = 1;
                currentImageRotation = 0;
                documentImage.style.filter = '';
                updateImageTransform();
            }
            
            /**
             * Ouvre le modal des facteurs de risque
             */
            function openRiskFactorsModal() {
                if (!currentDocumentId) return;
                
                // R√©cup√©rer le document actuel
                let currentDoc = allDocuments.find(doc => doc.id.toString() === currentDocumentId.toString());
                if (!currentDoc) {
                    currentDoc = allFlaggedDocuments.find(doc => doc.id.toString() === currentDocumentId.toString());
                }
                
                if (!currentDoc) return;
                
                // Calculer le score de risque
                const riskResult = calculateRiskScore(currentDoc);
                const { score, level, factors } = riskResult;
                
                // Formater le score en pourcentage
                const scorePercent = Math.round(score * 100);
                
                // Mettre √† jour la jauge et le score
                const riskGaugeFill = document.getElementById('risk-gauge-fill');
                const riskScorePercent = document.getElementById('risk-score-percent');
                const riskLevelText = document.getElementById('risk-level-text');
                
                riskGaugeFill.style.width = `${scorePercent}%`;
                riskScorePercent.textContent = `${scorePercent}%`;
                
                // Mettre √† jour le niveau de risque textuel
                riskLevelText.textContent = level === 'high' ? 'Risque √©lev√©' : (level === 'medium' ? 'Risque moyen' : 'Risque faible');
                riskLevelText.className = '';
                riskLevelText.classList.add(level);
                
                // Recommandation
                const recommendationText = document.getElementById('risk-recommendation-text');
                if (level === 'high') {
                    recommendationText.textContent = 'V√©rification approfondie requise. Plusieurs incoh√©rences ou facteurs de risque ont √©t√© d√©tect√©s.';
                } else if (level === 'medium') {
                    recommendationText.textContent = 'V√©rification manuelle recommand√©e par un agent. Des incoh√©rences mineures ont √©t√© d√©tect√©es.';
                } else {
                    recommendationText.textContent = 'V√©rification standard. Aucun facteur de risque significatif n\'a √©t√© d√©tect√©.';
                }
                
                // Remplir la liste des facteurs de risque
                const riskFactorsList = document.getElementById('risk-factors-list');
                riskFactorsList.innerHTML = '';
                
                // Trier les facteurs par impact
                const sortedFactors = [...factors].sort((a, b) => b.impact - a.impact);
                
                // G√©n√©rer les √©l√©ments HTML pour chaque facteur
                sortedFactors.forEach(factor => {
                    const factorItem = document.createElement('div');
                    factorItem.className = 'risk-factor-item';
                    
                    let impactLevel = 'low';
                    if (factor.impact >= 0.7) {
                        impactLevel = 'high';
                    } else if (factor.impact >= 0.4) {
                        impactLevel = 'medium';
                    }
                    
                    factorItem.innerHTML = `
                        <div class="risk-factor-name">${factor.name}</div>
                        <div class="risk-factor-impact ${impactLevel}">${getImpactText(factor.impact)}</div>
                    `;
                    
                    riskFactorsList.appendChild(factorItem);
                });
                
                // Afficher le modal
                const riskFactorsModal = document.getElementById('risk-factors-modal');
                riskFactorsModal.classList.add('active');
            }
            
            /**
             * Ferme le modal des facteurs de risque
             */
            function closeRiskFactorsModal() {
                const riskFactorsModal = document.getElementById('risk-factors-modal');
                riskFactorsModal.classList.remove('active');
            }
            
            /**
             * Convertit une valeur d'impact en texte
             */
            function getImpactText(impact) {
                if (impact >= 0.7) return '√âlev√©';
                if (impact >= 0.4) return 'Moyen';
                return 'Faible';
            }
            
            /**
             * Met √† jour la transformation CSS de l'image
             */
            function updateImageTransform() {
                documentImage.style.transform = `scale(${currentImageZoom}) rotate(${currentImageRotation}deg)`;
            }
            
            /**
             * S√©lectionne un outil d'annotation
             * @param {Event} event - √âv√©nement de clic
             */
            function selectAnnotationTool(event) {
                // D√©s√©lectionner tous les outils
                annotationButtons.forEach(btn => btn.classList.remove('active'));
                
                if (activeAnnotationTool === event.target.id) {
                    // Si l'outil est d√©j√† actif, le d√©sactiver
                    activeAnnotationTool = null;
                } else {
                    // Sinon, l'activer
                    activeAnnotationTool = event.target.id;
                    event.target.classList.add('active');
                }
            }
            
            /**
             * Formate le type de document
             * @param {string} type - Type de document
             * @returns {string} Type format√©
             */
            function formatDocumentType(type) {
                switch (type) {
                    case 'identity_card':
                        return 'Carte d\'identit√©';
                    case 'passport':
                        return 'Passeport';
                    case 'driving_license':
                        return 'Permis de conduire';
                    case 'residence_proof':
                        return 'Justificatif de domicile';
                    case 'selfie':
                        return 'Selfie';
                    default:
                        return type || 'Document inconnu';
                }
            }
            
            /**
             * D√©termine le format de fichier √† partir du chemin
             * @param {string} path - Chemin du fichier
             * @returns {string} Format du fichier
             */
            function getFileFormat(path) {
                if (!path) return 'Inconnu';
                
                const extension = path.split('.').pop().toLowerCase();
                switch (extension) {
                    case 'jpg':
                    case 'jpeg':
                        return 'JPEG';
                    case 'png':
                        return 'PNG';
                    case 'pdf':
                        return 'PDF';
                    case 'gif':
                        return 'GIF';
                    case 'webp':
                        return 'WebP';
                    default:
                        return extension.toUpperCase();
                }
            }
            
            /**
             * Simule des documents pour la d√©monstration
             * Note: Dans une impl√©mentation r√©elle, cette fonction n'est pas n√©cessaire
             */
            function simulateDocuments() {
                allDocuments = [
                    {
                        id: 1,
                        userId: 101,
                        username: 'joueur1',
                        email: 'joueur1@example.com',
                        userRegistrationDate: '2024-02-15',
                        userCountry: 'France',
                        userDocumentCount: 2,
                        userLastLogin: new Date().toISOString(),
                        userIp: '192.168.1.1',
                        userStatus: 'Actif',
                        documentType: 'identity_card',
                        documentNumber: 'ID12345678',
                        expiryDate: '2028-05-15',
                        country: 'FR',
                        filePath: 'identity_card/id_101.jpg',
                        fileFormat: 'JPEG',
                        fileSize: '2.3 MB',
                        originalFilename: 'id_card.jpg',
                        uploadDate: new Date().toISOString(),
                        riskLevel: 'low'
                    },
                    {
                        id: 2,
                        userId: 102,
                        username: 'joueur2',
                        email: 'joueur2@example.com',
                        userRegistrationDate: '2024-01-08',
                        userCountry: 'Nouvelle-Cal√©donie',
                        userDocumentCount: 1,
                        userLastLogin: new Date().toISOString(),
                        userIp: '203.45.16.78',
                        userStatus: 'Actif',
                        documentType: 'passport',
                        documentNumber: 'P987654321',
                        expiryDate: '2027-08-22',
                        country: 'NC',
                        filePath: 'passport/passport_102.jpg',
                        fileFormat: 'JPEG',
                        fileSize: '1.8 MB',
                        originalFilename: 'passport.jpg',
                        uploadDate: new Date().toISOString(),
                        riskLevel: 'medium'
                    },
                    {
                        id: 3,
                        userId: 103,
                        username: 'joueur3',
                        email: 'joueur3@example.com',
                        userRegistrationDate: '2023-11-20',
                        userCountry: 'Polyn√©sie Fran√ßaise',
                        userDocumentCount: 3,
                        userLastLogin: new Date().toISOString(),
                        userIp: '211.78.45.92',
                        userStatus: 'Actif',
                        documentType: 'residence_proof',
                        documentNumber: '',
                        expiryDate: '',
                        country: 'PF',
                        filePath: 'residence_proof/proof_103.pdf',
                        fileFormat: 'PDF',
                        fileSize: '0.9 MB',
                        originalFilename: 'facture_electricite.pdf',
                        uploadDate: new Date().toISOString(),
                        riskLevel: 'high'
                    }
                ];
                
                totalDocuments = allDocuments.length;
                pendingCountBadge.textContent = totalDocuments;
                dashboardPendingCount.textContent = totalDocuments;
                
                // Appliquer les filtres
                applyFilters();
            }
            
            /**
             * Simule des documents signal√©s pour la d√©monstration
             */
            function simulateFlaggedDocuments() {
                allFlaggedDocuments = [
                    {
                        id: 4,
                        userId: 104,
                        username: 'joueur4',
                        email: 'joueur4@example.com',
                        userRegistrationDate: '2024-03-10',
                        userCountry: 'France',
                        userDocumentCount: 1,
                        userLastLogin: new Date().toISOString(),
                        userIp: '172.16.254.1',
                        userStatus: 'Actif',
                        documentType: 'identity_card',
                        documentNumber: 'ID987654321',
                        expiryDate: '2025-04-15',
                        country: 'FR',
                        filePath: 'identity_card/id_104.jpg',
                        fileFormat: 'JPEG',
                        fileSize: '2.1 MB',
                        originalFilename: 'id_card.jpg',
                        uploadDate: '2024-04-01T14:30:00Z',
                        flagDate: '2024-04-02T09:15:00Z',
                        flagReason: 'Informations incoh√©rentes avec le profil',
                        flaggedBy: 'admin-2',
                        riskLevel: 'high'
                    },
                    {
                        id: 5,
                        userId: 105,
                        username: 'joueur5',
                        email: 'joueur5@example.com',
                        userRegistrationDate: '2024-02-22',
                        userCountry: 'Wallis-et-Futuna',
                        userDocumentCount: 2,
                        userLastLogin: new Date().toISOString(),
                        userIp: '198.51.100.42',
                        userStatus: 'Actif',
                        documentType: 'passport',
                        documentNumber: 'P123456789',
                        expiryDate: '2029-01-30',
                        country: 'WF',
                        filePath: 'passport/passport_105.jpg',
                        fileFormat: 'JPEG',
                        fileSize: '1.7 MB',
                        originalFilename: 'passport.jpg',
                        uploadDate: '2024-03-15T10:45:00Z',
                        flagDate: '2024-03-15T16:20:00Z',
                        flagReason: 'Document potentiellement modifi√©',
                        flaggedBy: 'syst√®me',
                        riskLevel: 'high'
                    }
                ];
                
                flaggedCountBadge.textContent = allFlaggedDocuments.length;
                
                renderFlaggedDocuments();
            }
            
            /**
             * Simule des donn√©es d'historique pour la d√©monstration
             */
            function simulateHistoryData() {
                allHistory = [
                    {
                        id: 1,
                        date: '2024-04-10T14:30:00Z',
                        admin: 'admin-1',
                        action: 'approved',
                        username: 'joueur6',
                        documentId: 6,
                        documentType: 'identity_card',
                        details: 'Document valid√©'
                    },
                    {
                        id: 2,
                        date: '2024-04-10T11:45:00Z',
                        admin: 'admin-2',
                        action: 'rejected',
                        username: 'joueur7',
                        documentId: 7,
                        documentType: 'residence_proof',
                        details: 'Document expir√©'
                    },
                    {
                        id: 3,
                        date: '2024-04-09T16:20:00Z',
                        admin: 'admin-1',
                        action: 'flagged',
                        username: 'joueur5',
                        documentId: 5,
                        documentType: 'passport',
                        details: 'Document potentiellement modifi√©'
                    },
                    {
                        id: 4,
                        date: '2024-04-09T09:10:00Z',
                        admin: 'admin-2',
                        action: 'commented',
                        username: 'joueur4',
                        documentId: 4,
                        documentType: 'identity_card',
                        details: 'Informations incoh√©rentes avec le profil'
                    },
                    {
                        id: 5,
                        date: '2024-04-08T15:30:00Z',
                        admin: 'admin-1',
                        action: 'approved',
                        username: 'joueur8',
                        documentId: 8,
                        documentType: 'driving_license',
                        details: 'Document valid√©'
                    }
                ];
                
                applyHistoryFilters();
            }
            
            /**
             * Initialise le graphique de volume de documents
             */
            function initDocumentsChart() {
                const ctx = document.getElementById('documentsVolumeChart').getContext('2d');
                
                // Donn√©es pour les 30 derniers jours
                const labels = Array.from({length: 30}, (_, i) => {
                    const d = new Date();
                    d.setDate(d.getDate() - 30 + i + 1);
                    return d.toLocaleDateString('fr-FR', {day: 'numeric', month: 'short'});
                });
                
                // Donn√©es simul√©es
                const approvedData = Array.from({length: 30}, () => Math.floor(Math.random() * 10) + 2);
                const rejectedData = Array.from({length: 30}, () => Math.floor(Math.random() * 5) + 1);
                const pendingData = Array.from({length: 30}, () => Math.floor(Math.random() * 3) + 1);
                
                // Configuration du graphique
                const documentsChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Approuv√©s',
                                data: approvedData,
                                backgroundColor: 'rgba(46, 125, 50, 0.2)',
                                borderColor: 'rgba(46, 125, 50, 1)',
                                borderWidth: 2,
                                tension: 0.3,
                                pointRadius: 2,
                                pointHoverRadius: 5
                            },
                            {
                                label: 'Refus√©s',
                                data: rejectedData,
                                backgroundColor: 'rgba(198, 40, 40, 0.2)',
                                borderColor: 'rgba(198, 40, 40, 1)',
                                borderWidth: 2,
                                tension: 0.3,
                                pointRadius: 2,
                                pointHoverRadius: 5
                            },
                            {
                                label: 'En attente',
                                data: pendingData,
                                backgroundColor: 'rgba(255, 152, 0, 0.2)',
                                borderColor: 'rgba(255, 152, 0, 1)',
                                borderWidth: 2,
                                tension: 0.3,
                                pointRadius: 2,
                                pointHoverRadius: 5
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    boxWidth: 12,
                                    padding: 15
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                backgroundColor: 'rgba(0, 0, 0, 0.7)',
                                padding: 10,
                                cornerRadius: 4
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 45
                                }
                            },
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                },
                                ticks: {
                                    precision: 0
                                }
                            }
                        }
                    }
                });
                
                // Initialiser les autres graphiques
                initDocumentTypesChart();
                initProcessingTimeChart();
                
                // Initialiser le syst√®me d'alertes de risque
                initRiskAlerts();
            }
            
            /**
             * Initialise le graphique de r√©partition par type de document
             */
            function initDocumentTypesChart() {
                const ctx = document.getElementById('documentTypesChart').getContext('2d');
                
                // Donn√©es simul√©es pour les types de documents
                const data = {
                    labels: ['Carte d\'identit√©', 'Passeport', 'Permis de conduire', 'Justificatif de domicile', 'Selfie'],
                    datasets: [{
                        data: [35, 25, 15, 20, 5],
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(153, 102, 255, 0.7)',
                            'rgba(255, 159, 64, 0.7)',
                            'rgba(255, 99, 132, 0.7)'
                        ],
                        borderColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(255, 99, 132, 1)'
                        ],
                        borderWidth: 1
                    }]
                };
                
                // Configuration du graphique
                const documentTypesChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    boxWidth: 12,
                                    padding: 15,
                                    font: {
                                        size: 11
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.7)',
                                padding: 10,
                                cornerRadius: 4,
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const total = context.dataset.data.reduce((acc, val) => acc + val, 0);
                                        const percentage = Math.round((value / total) * 100);
                                        return `${label}: ${value} (${percentage}%)`;
                                    }
                                }
                            }
                        },
                        cutout: '65%'
                    }
                });
            }
            
            /**
             * Initialise le graphique de temps de traitement moyen par type
             */
            function initProcessingTimeChart() {
                const ctx = document.getElementById('processingTimeChart').getContext('2d');
                
                // Donn√©es simul√©es pour le temps de traitement (en heures)
                const data = {
                    labels: ['Carte d\'identit√©', 'Passeport', 'Permis de conduire', 'Justificatif de domicile', 'Selfie'],
                    datasets: [{
                        label: 'Temps moyen (heures)',
                        data: [8, 10, 7, 5, 2],
                        backgroundColor: 'rgba(25, 118, 210, 0.7)',
                        borderColor: 'rgba(25, 118, 210, 1)',
                        borderWidth: 1,
                        borderRadius: 5,
                        maxBarThickness: 40
                    }]
                };
                
                // Configuration du graphique
                const processingTimeChart = new Chart(ctx, {
                    type: 'bar',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.7)',
                                padding: 10,
                                cornerRadius: 4,
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw || 0;
                                        return `Temps moyen: ${value} heures`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    font: {
                                        size: 10
                                    }
                                }
                            },
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                },
                                ticks: {
                                    precision: 0
                                }
                            }
                        }
                    }
                });
            }
            
            /**
             * Initialise le syst√®me d'alertes de risque
             */
            function initRiskAlerts() {
                const alertsList = document.getElementById('risk-alerts-list');
                const alertFilters = document.querySelectorAll('.admin-alert-filter');
                
                // Donn√©es simul√©es pour les alertes
                const alerts = [
                    {
                        id: 1,
                        type: 'high',
                        username: 'joueur42',
                        documentType: 'identity_card',
                        message: 'Document potentiellement manipul√© (d√©tection d\'√©dition d\'image)',
                        time: '2h',
                        riskScore: 0.85
                    },
                    {
                        id: 2,
                        type: 'medium',
                        username: 'joueur18',
                        documentType: 'passport',
                        message: 'Date de naissance ne correspond pas aux informations du compte',
                        time: '4h',
                        riskScore: 0.65
                    },
                    {
                        id: 3,
                        type: 'high',
                        username: 'joueur23',
                        documentType: 'driving_license',
                        message: 'Document expir√© depuis plus de 3 mois',
                        time: '5h',
                        riskScore: 0.78
                    },
                    {
                        id: 4,
                        type: 'duplicate',
                        username: 'joueur7',
                        documentType: 'identity_card',
                        message: 'Document similaire trouv√© pour un autre compte (joueur56)',
                        time: '12h',
                        riskScore: 0.92
                    },
                    {
                        id: 5,
                        type: 'medium',
                        username: 'joueur31',
                        documentType: 'residence_proof',
                        message: 'Adresse non reconnue par le syst√®me de validation',
                        time: '16h',
                        riskScore: 0.58
                    }
                ];
                
                // Rendu des alertes
                renderRiskAlerts(alerts);
                
                // Gestionnaire d'√©v√©nements pour les filtres d'alerte
                alertFilters.forEach(filter => {
                    filter.addEventListener('click', function() {
                        // Supprimer la classe active de tous les filtres
                        alertFilters.forEach(f => f.classList.remove('active'));
                        
                        // Ajouter la classe active au filtre cliqu√©
                        this.classList.add('active');
                        
                        // Obtenir le type de filtre
                        const filterType = this.getAttribute('data-filter');
                        
                        // Filtrer les alertes
                        let filteredAlerts = alerts;
                        if (filterType !== 'all') {
                            filteredAlerts = alerts.filter(alert => alert.type === filterType);
                        }
                        
                        // Rendu des alertes filtr√©es
                        renderRiskAlerts(filteredAlerts);
                    });
                });
                
                // Notifier l'administrateur des alertes √† haut risque
                setTimeout(() => {
                    const highRiskCount = alerts.filter(alert => alert.type === 'high').length;
                    if (highRiskCount > 0) {
                        showNotification(
                            'Alertes de risque d√©tect√©es', 
                            `${highRiskCount} document(s) √† risque √©lev√© n√©cessitent votre attention.`, 
                            'warning'
                        );
                    }
                }, 5000);
            }
            
            /**
             * Affiche les alertes de risque dans l'interface
             * @param {Array} alerts - Liste des alertes √† afficher
             */
            function renderRiskAlerts(alerts) {
                const alertsList = document.getElementById('risk-alerts-list');
                
                // Vider la liste
                alertsList.innerHTML = '';
                
                // Si aucune alerte, afficher un message
                if (alerts.length === 0) {
                    alertsList.innerHTML = '<div class="admin-no-data">Aucune alerte correspondant aux filtres.</div>';
                    return;
                }
                
                // Parcourir les alertes et les afficher
                alerts.forEach(alert => {
                    const alertEl = document.createElement('div');
                    alertEl.className = 'admin-alert-item';
                    
                    // D√©terminer l'ic√¥ne en fonction du type d'alerte
                    let icon = '‚ö†Ô∏è';
                    if (alert.type === 'high') {
                        icon = 'üî¥';
                    } else if (alert.type === 'medium') {
                        icon = 'üü†';
                    } else if (alert.type === 'duplicate') {
                        icon = 'üîÑ';
                    }
                    
                    // D√©terminer la classe de risque
                    let riskClass = 'medium';
                    if (alert.riskScore >= 0.75) {
                        riskClass = 'high';
                    } else if (alert.riskScore < 0.5) {
                        riskClass = 'low';
                    }
                    
                    // Cr√©er le contenu HTML de l'alerte
                    alertEl.innerHTML = `
                        <div class="admin-alert-icon ${alert.type}">
                            ${icon}
                        </div>
                        <div class="admin-alert-content">
                            <div class="admin-alert-content-header">
                                <div class="admin-alert-name">${alert.username} - ${formatDocumentType(alert.documentType)}</div>
                                <div class="admin-alert-time">il y a ${alert.time}</div>
                            </div>
                            <div class="admin-alert-message">${alert.message}</div>
                            <div class="admin-alert-risk">
                                <span class="admin-alert-risk-label">Niveau de risque:</span>
                                <span class="admin-alert-risk-score ${riskClass}">${(alert.riskScore * 100).toFixed(0)}%</span>
                            </div>
                        </div>
                        <div class="admin-alert-actions">
                            <button class="action-button view" data-alert-id="${alert.id}">Voir</button>
                        </div>
                    `;
                    
                    // Ajouter l'alerte √† la liste
                    alertsList.appendChild(alertEl);
                });
                
                // Ajouter des gestionnaires d'√©v√©nements pour les boutons d'action
                const viewButtons = alertsList.querySelectorAll('.action-button.view');
                viewButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const alertId = this.getAttribute('data-alert-id');
                        openAlertDocument(alertId);
                    });
                });
            }
            
            /**
             * Ouvre le document li√© √† une alerte
             * @param {string} alertId - ID de l'alerte
             */
            function openAlertDocument(alertId) {
                // Dans une impl√©mentation r√©elle, on r√©cup√©rerait le document li√© √† l'alerte
                // Pour la d√©mo, on simule l'ouverture du modal avec un document al√©atoire
                showNotification('Ouverture du document', 'Chargement du document li√© √† l\'alerte #' + alertId, 'info');
                
                // Simuler un d√©lai de chargement
                setTimeout(() => {
                    const documentId = Math.floor(Math.random() * 20) + 1;
                    openDocumentModal(documentId);
                }, 500);
            }
            
            /**
             * Initialise le syst√®me de notification pour l'administrateur
             */
            function initNotificationSystem() {
                // Cr√©e l'√©l√©ment de notification s'il n'existe pas d√©j√†
                if (!document.getElementById('admin-notification-center')) {
                    const notificationCenter = document.createElement('div');
                    notificationCenter.id = 'admin-notification-center';
                    notificationCenter.className = 'admin-notification-center';
                    
                    // Ajouter les styles CSS pour le centre de notification
                    const style = document.createElement('style');
                    style.textContent = `
                        .admin-notification-center {
                            position: fixed;
                            top: 20px;
                            right: 20px;
                            z-index: 9999;
                            width: 320px;
                        }
                        
                        .admin-notification {
                            background-color: #fff;
                            border-left: 4px solid #1976d2;
                            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                            border-radius: 4px;
                            padding: 16px;
                            margin-bottom: 10px;
                            animation: slideIn 0.3s ease-out, fadeOut 0.5s ease-out 4.5s forwards;
                            position: relative;
                            cursor: pointer;
                            transition: transform 0.2s ease;
                        }
                        
                        .admin-notification:hover {
                            transform: translateY(-3px);
                        }
                        
                        .admin-notification.success {
                            border-left-color: #2e7d32;
                        }
                        
                        .admin-notification.error {
                            border-left-color: #c62828;
                        }
                        
                        .admin-notification.warning {
                            border-left-color: #ff9800;
                        }
                        
                        .admin-notification-title {
                            font-weight: 500;
                            margin-bottom: 5px;
                            color: #37474f;
                            font-size: 16px;
                        }
                        
                        .admin-notification-message {
                            font-size: 14px;
                            color: #546e7a;
                        }
                        
                        .admin-notification-close {
                            position: absolute;
                            top: 10px;
                            right: 10px;
                            background: none;
                            border: none;
                            cursor: pointer;
                            font-size: 16px;
                            color: #78909c;
                        }
                        
                        @keyframes slideIn {
                            from { transform: translateX(100%); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                        
                        @keyframes fadeOut {
                            from { opacity: 1; }
                            to { opacity: 0; visibility: hidden; }
                        }
                    `;
                    
                    document.head.appendChild(style);
                    document.body.appendChild(notificationCenter);
                    
                    // D√©monstration du syst√®me de notification
                    setTimeout(() => {
                        showNotification('Bienvenue dans l\'interface KYC', 'Le tableau de bord a √©t√© charg√© avec succ√®s.', 'success');
                    }, 1000);
                    
                    setTimeout(() => {
                        showNotification('Documents en attente', '3 nouveaux documents ont √©t√© soumis et attendent une v√©rification.', 'warning');
                    }, 3000);
                }
            }
            
            /**
             * Affiche une notification √† l'administrateur
             * @param {string} title - Titre de la notification
             * @param {string} message - Message de la notification
             * @param {string} type - Type de notification (success, error, warning, info)
             */
            function showNotification(title, message, type = 'info') {
                const notificationCenter = document.getElementById('admin-notification-center');
                if (!notificationCenter) return;
                
                const notification = document.createElement('div');
                notification.className = `admin-notification ${type}`;
                
                notification.innerHTML = `
                    <button class="admin-notification-close">&times;</button>
                    <div class="admin-notification-title">${title}</div>
                    <div class="admin-notification-message">${message}</div>
                `;
                
                // Ajouter la notification au centre
                notificationCenter.appendChild(notification);
                
                // Configurer la fermeture manuelle
                const closeBtn = notification.querySelector('.admin-notification-close');
                closeBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    notification.remove();
                });
                
                // Configurer la fermeture au clic sur la notification
                notification.addEventListener('click', function() {
                    notification.remove();
                });
                
                // Configurer la fermeture automatique apr√®s 5 secondes
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 5000);
            }
            
            /**
             * Simule des donn√©es de tableau de bord pour la d√©monstration
             */
            function simulateDashboardData() {
                dashboardPendingCount.textContent = '3';
                dashboardApprovedCount.textContent = '24';
                dashboardRejectedCount.textContent = '8';
                document.getElementById('dashboard-processing-time').textContent = '8h';
                
                document.getElementById('high-risk-count').textContent = '5';
                document.getElementById('medium-risk-count').textContent = '12';
                document.getElementById('duplicate-count').textContent = '3';
                document.getElementById('multi-doc-count').textContent = '8';
                
                const recentDocuments = [
                    {
                        id: 9,
                        username: 'joueur9',
                        documentType: 'identity_card',
                        uploadDate: '2024-04-09T14:30:00Z',
                        processedBy: 'admin-1',
                        processDate: '2024-04-10T09:15:00Z',
                        status: 'approved'
                    },
                    {
                        id: 10,
                        username: 'joueur10',
                        documentType: 'passport',
                        uploadDate: '2024-04-08T11:20:00Z',
                        processedBy: 'admin-2',
                        processDate: '2024-04-09T16:45:00Z',
                        status: 'rejected'
                    },
                    {
                        id: 11,
                        username: 'joueur11',
                        documentType: 'residence_proof',
                        uploadDate: '2024-04-08T09:10:00Z',
                        processedBy: 'admin-1',
                        processDate: '2024-04-09T10:30:00Z',
                        status: 'approved'
                    }
                ];
                
                renderRecentDocuments(recentDocuments);
            }
            
            /**
             * Exporte l'historique des v√©rifications au format CSV
             * @param {string} exportType - Type d'export: 'all', 'high-risk', 'by-date', 'by-user'
             */
            function exportHistoryToCSV(exportType = 'all') {
                // Collecter les donn√©es d'historique
                let historyData = allHistory || [];
                
                if (historyData.length === 0) {
                    showNotification('Export impossible', 'Aucune donn√©e d\'historique √† exporter.', 'error');
                    return;
                }
                
                // Filtrer les donn√©es selon le type d'export
                switch(exportType) {
                    case 'high-risk':
                        // Filtrer uniquement les documents √† risque √©lev√©
                        historyData = historyData.filter(entry => 
                            entry.riskLevel === 'high' || 
                            entry.details?.includes('risque √©lev√©') ||
                            entry.action === 'flagged'
                        );
                        if (historyData.length === 0) {
                            showNotification('Export impossible', 'Aucun document √† risque √©lev√© dans l\'historique.', 'warning');
                            return;
                        }
                        break;
                    case 'by-date':
                        // Demander √† l'utilisateur de s√©lectionner une plage de dates
                        const startDate = prompt('Veuillez entrer la date de d√©but (YYYY-MM-DD):', 
                            new Date(Date.now() - 30*24*60*60*1000).toISOString().slice(0,10));
                        
                        if (!startDate) return; // L'utilisateur a annul√©
                        
                        const endDate = prompt('Veuillez entrer la date de fin (YYYY-MM-DD):', 
                            new Date().toISOString().slice(0,10));
                            
                        if (!endDate) return; // L'utilisateur a annul√©
                        
                        // Filtrer par plage de dates
                        historyData = historyData.filter(entry => {
                            const entryDate = new Date(entry.date);
                            return entryDate >= new Date(startDate) && entryDate <= new Date(endDate);
                        });
                        
                        if (historyData.length === 0) {
                            showNotification('Export impossible', 'Aucune donn√©e pour cette p√©riode.', 'warning');
                            return;
                        }
                        break;
                    case 'by-user':
                        // Demander √† l'utilisateur de saisir un nom d'utilisateur
                        const username = prompt('Veuillez entrer le nom d\'utilisateur:');
                        
                        if (!username) return; // L'utilisateur a annul√©
                        
                        // Filtrer par nom d'utilisateur
                        historyData = historyData.filter(entry => 
                            entry.username && entry.username.toLowerCase().includes(username.toLowerCase())
                        );
                        
                        if (historyData.length === 0) {
                            showNotification('Export impossible', 'Aucune donn√©e pour cet utilisateur.', 'warning');
                            return;
                        }
                        break;
                    default:
                        // Toutes les donn√©es (aucun filtre)
                        break;
                }
                
                // En-t√™tes des colonnes
                const headers = [
                    'ID',
                    'Date',
                    'Administrateur',
                    'Action',
                    'Utilisateur',
                    'Type de document',
                    'D√©tails'
                ];
                
                // Pr√©parer les lignes de donn√©es
                const dataRows = historyData.map(entry => {
                    const date = new Date(entry.date).toLocaleString('fr-FR');
                    return [
                        entry.id,
                        date,
                        entry.admin,
                        formatActionType(entry.action),
                        entry.username,
                        formatDocumentType(entry.documentType),
                        entry.details
                    ];
                });
                
                // Formater en CSV
                let csvContent = headers.join(',') + '\n';
                
                dataRows.forEach(row => {
                    // √âchapper les valeurs contenant des virgules avec des guillemets
                    const escapedRow = row.map(value => {
                        if (value === null || value === undefined) return '';
                        
                        const stringValue = String(value);
                        // Si contient des virgules, guillemets ou sauts de ligne, l'encadrer avec des guillemets
                        if (stringValue.includes(',') || stringValue.includes('"') || stringValue.includes('\n')) {
                            // √âchapper les guillemets en les doublant
                            return '"' + stringValue.replace(/"/g, '""') + '"';
                        }
                        return stringValue;
                    });
                    
                    csvContent += escapedRow.join(',') + '\n';
                });
                
                // Cr√©er un blob et un lien de t√©l√©chargement
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                
                // G√©n√©rer un nom de fichier avec date et heure
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-').substring(0, 19);
                const filename = `msbingo-kyc-history-${timestamp}.csv`;
                
                // Cr√©er un lien temporaire pour le t√©l√©chargement
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.display = 'none';
                
                // Ajouter √† la page, cliquer, puis supprimer
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Lib√©rer l'URL
                setTimeout(() => {
                    URL.revokeObjectURL(url);
                }, 100);
                
                showNotification('Export r√©ussi', 'L\'historique a √©t√© export√© au format CSV.', 'success');
            }
            
            /**
             * Exporte l'historique des v√©rifications au format PDF
             * @param {string} exportType - Type d'export: 'all', 'high-risk', 'by-date', 'by-user'
             */
            function exportHistoryToPDF(exportType = 'all') {
                // Collecter les donn√©es d'historique
                let historyData = allHistory || [];
                
                if (historyData.length === 0) {
                    showNotification('Export impossible', 'Aucune donn√©e d\'historique √† exporter.', 'error');
                    return;
                }
                
                // Filtrer les donn√©es selon le type d'export
                switch(exportType) {
                    case 'high-risk':
                        // Filtrer uniquement les documents √† risque √©lev√©
                        historyData = historyData.filter(entry => 
                            entry.riskLevel === 'high' || 
                            entry.details?.includes('risque √©lev√©') ||
                            entry.action === 'flagged'
                        );
                        if (historyData.length === 0) {
                            showNotification('Export impossible', 'Aucun document √† risque √©lev√© dans l\'historique.', 'warning');
                            return;
                        }
                        break;
                    case 'by-date':
                        // Demander √† l'utilisateur de s√©lectionner une plage de dates
                        const startDate = prompt('Veuillez entrer la date de d√©but (YYYY-MM-DD):', 
                            new Date(Date.now() - 30*24*60*60*1000).toISOString().slice(0,10));
                        
                        if (!startDate) return; // L'utilisateur a annul√©
                        
                        const endDate = prompt('Veuillez entrer la date de fin (YYYY-MM-DD):', 
                            new Date().toISOString().slice(0,10));
                            
                        if (!endDate) return; // L'utilisateur a annul√©
                        
                        // Filtrer par plage de dates
                        historyData = historyData.filter(entry => {
                            const entryDate = new Date(entry.date);
                            return entryDate >= new Date(startDate) && entryDate <= new Date(endDate);
                        });
                        
                        if (historyData.length === 0) {
                            showNotification('Export impossible', 'Aucune donn√©e pour cette p√©riode.', 'warning');
                            return;
                        }
                        break;
                    case 'by-user':
                        // Demander √† l'utilisateur de saisir un nom d'utilisateur
                        const username = prompt('Veuillez entrer le nom d\'utilisateur:');
                        
                        if (!username) return; // L'utilisateur a annul√©
                        
                        // Filtrer par nom d'utilisateur
                        historyData = historyData.filter(entry => 
                            entry.username && entry.username.toLowerCase().includes(username.toLowerCase())
                        );
                        
                        if (historyData.length === 0) {
                            showNotification('Export impossible', 'Aucune donn√©e pour cet utilisateur.', 'warning');
                            return;
                        }
                        break;
                    default:
                        // Toutes les donn√©es (aucun filtre)
                        break;
                }
                
                showNotification('G√©n√©ration en cours', 'Pr√©paration du PDF en cours...', 'info');
                
                // Cr√©er le contenu HTML temporaire pour la conversion en PDF
                const tmpDiv = document.createElement('div');
                tmpDiv.style.display = 'none';
                document.body.appendChild(tmpDiv);
                
                // Pr√©parer les statistiques pour les graphiques
                // Compter le nombre d'entr√©es par type d'action
                const actionCounts = {
                    approved: 0,
                    rejected: 0,
                    flagged: 0,
                    commented: 0
                };
                
                historyData.forEach(entry => {
                    if (entry.action && actionCounts[entry.action] !== undefined) {
                        actionCounts[entry.action]++;
                    }
                });
                
                // Compter le nombre d'entr√©es par niveau de risque
                const riskCounts = {
                    high: 0,
                    medium: 0,
                    low: 0
                };
                
                historyData.forEach(entry => {
                    if (entry.riskLevel) {
                        riskCounts[entry.riskLevel]++;
                    } else if (entry.action === 'flagged') {
                        riskCounts.high++;
                    } else if (entry.details && entry.details.includes('risque √©lev√©')) {
                        riskCounts.high++;
                    } else {
                        riskCounts.low++;
                    }
                });
                
                // Calculer les pourcentages pour les jauges
                const highRiskPercent = Math.round((riskCounts.high / historyData.length) * 100) || 0;
                const mediumRiskPercent = Math.round((riskCounts.medium / historyData.length) * 100) || 0;
                const lowRiskPercent = Math.round((riskCounts.low / historyData.length) * 100) || 0;
                
                // D√©finir les styles pour le PDF
                tmpDiv.innerHTML = `
                    <div id="pdf-content" style="font-family: Arial, sans-serif; padding: 20px;">
                        <div style="text-align: center; margin-bottom: 30px;">
                            <h1 style="color: #1976d2; margin: 0;">MS BINGO KYC</h1>
                            <h2 style="color: #455a64; margin: 10px 0 0;">Rapport d'historique des v√©rifications</h2>
                            <p style="color: #78909c;">G√©n√©r√© le ${new Date().toLocaleString('fr-FR')}</p>
                        </div>
                        
                        <!-- Tableau de bord r√©sum√© -->
                        <div style="margin-bottom: 30px; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; background-color: #f9f9f9;">
                            <h3 style="color: #1976d2; margin-top: 0;">R√©sum√© des v√©rifications</h3>
                            
                            <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                                <div style="flex: 1; text-align: center; padding: 10px; background-color: #fff; border-radius: 5px; margin-right: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                    <h4 style="margin: 0 0 10px; color: #455a64;">Documents v√©rifi√©s</h4>
                                    <p style="font-size: 24px; font-weight: bold; margin: 0; color: #1976d2;">${historyData.length}</p>
                                </div>
                                
                                <div style="flex: 1; text-align: center; padding: 10px; background-color: #fff; border-radius: 5px; margin-right: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                    <h4 style="margin: 0 0 10px; color: #455a64;">Documents approuv√©s</h4>
                                    <p style="font-size: 24px; font-weight: bold; margin: 0; color: #2e7d32;">${actionCounts.approved}</p>
                                </div>
                                
                                <div style="flex: 1; text-align: center; padding: 10px; background-color: #fff; border-radius: 5px; margin-right: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                    <h4 style="margin: 0 0 10px; color: #455a64;">Documents rejet√©s</h4>
                                    <p style="font-size: 24px; font-weight: bold; margin: 0; color: #c62828;">${actionCounts.rejected}</p>
                                </div>
                                
                                <div style="flex: 1; text-align: center; padding: 10px; background-color: #fff; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                    <h4 style="margin: 0 0 10px; color: #455a64;">Documents signal√©s</h4>
                                    <p style="font-size: 24px; font-weight: bold; margin: 0; color: #e65100;">${actionCounts.flagged}</p>
                                </div>
                            </div>
                            
                            <!-- Jauges de risque -->
                            <div style="margin-top: 20px;">
                                <h4 style="margin: 0 0 10px; color: #455a64;">R√©partition des niveaux de risque</h4>
                                
                                <div style="margin-bottom: 15px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                        <span style="color: #455a64;">Risque √©lev√©</span>
                                        <span style="color: #c62828; font-weight: bold;">${highRiskPercent}%</span>
                                    </div>
                                    <div style="height: 10px; background-color: #e0e0e0; border-radius: 5px; overflow: hidden;">
                                        <div style="height: 100%; width: ${highRiskPercent}%; background-color: #f44336;"></div>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                        <span style="color: #455a64;">Risque moyen</span>
                                        <span style="color: #e65100; font-weight: bold;">${mediumRiskPercent}%</span>
                                    </div>
                                    <div style="height: 10px; background-color: #e0e0e0; border-radius: 5px; overflow: hidden;">
                                        <div style="height: 100%; width: ${mediumRiskPercent}%; background-color: #ff9800;"></div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                        <span style="color: #455a64;">Risque faible</span>
                                        <span style="color: #2e7d32; font-weight: bold;">${lowRiskPercent}%</span>
                                    </div>
                                    <div style="height: 10px; background-color: #e0e0e0; border-radius: 5px; overflow: hidden;">
                                        <div style="height: 100%; width: ${lowRiskPercent}%; background-color: #4caf50;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tableau des donn√©es -->
                        <h3 style="color: #1976d2; margin-top: 30px;">D√©tail des v√©rifications</h3>
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
                            <thead>
                                <tr style="background-color: #f5f5f5;">
                                    <th style="padding: 10px; text-align: left; border-bottom: 1px solid #e0e0e0;">Date</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 1px solid #e0e0e0;">Admin</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 1px solid #e0e0e0;">Action</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 1px solid #e0e0e0;">Utilisateur</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 1px solid #e0e0e0;">Document</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 1px solid #e0e0e0;">D√©tails</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${historyData.map(entry => {
                                    const date = new Date(entry.date).toLocaleString('fr-FR');
                                    let rowStyle = '';
                                    
                                    // Coloration conditionnelle selon le niveau de risque
                                    if (entry.riskLevel === 'high' || entry.action === 'flagged') {
                                        rowStyle = 'background-color: #ffebee;';
                                    } else if (entry.riskLevel === 'medium') {
                                        rowStyle = 'background-color: #fff8e1;';
                                    }
                                    
                                    return `
                                        <tr style="border-bottom: 1px solid #f0f0f0; ${rowStyle}">
                                            <td style="padding: 10px;">${date}</td>
                                            <td style="padding: 10px;">${entry.admin || 'N/A'}</td>
                                            <td style="padding: 10px;">${formatActionType(entry.action)}</td>
                                            <td style="padding: 10px;">${entry.username}</td>
                                            <td style="padding: 10px;">${formatDocumentType(entry.documentType)}</td>
                                            <td style="padding: 10px;">${entry.details || ''}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                        
                        <!-- Signature √©lectronique / Watermark -->
                        <div style="position: relative; margin-top: 40px; margin-bottom: 40px;">
                            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; opacity: 0.1; transform: rotate(-30deg); font-size: 72px; color: #1976d2; font-weight: bold; pointer-events: none;">
                                PACIFIQUE MS BINGO
                            </div>
                            
                            <div style="position: relative; padding: 30px; border: 2px solid #1976d2; border-radius: 8px; background-color: #f5f9fd; z-index: 1;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                                    <div>
                                        <h4 style="margin: 0; color: #1976d2;">Signature √©lectronique</h4>
                                        <p style="margin: 5px 0 0; color: #455a64;">Ce document est certifi√© par Pacifique MS BINGO</p>
                                    </div>
                                    <div style="text-align: right;">
                                        <p style="margin: 0; color: #455a64;">Date: ${new Date().toLocaleDateString('fr-FR')}</p>
                                        <p style="margin: 5px 0 0; color: #455a64;">Heure: ${new Date().toLocaleTimeString('fr-FR')}</p>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 20px;">
                                    <p style="margin: 0; color: #37474f;">Identifiant unique: <strong>${timestamp}</strong></p>
                                    <p style="margin: 10px 0 0; color: #37474f;">√âmis par: <strong>Syst√®me KYC MS BINGO</strong></p>
                                    <p style="margin: 10px 0 0; color: #37474f;">Nombre d'entr√©es: <strong>${historyData.length}</strong></p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pied de page -->
                        <div style="margin-top: 50px; text-align: center; color: #78909c; font-size: 12px; border-top: 1px solid #e0e0e0; padding-top: 20px;">
                            <p style="margin: 5px 0;">Document confidentiel - Pacifique MS BINGO</p>
                            <p style="margin: 5px 0;">Ce document contient des informations sensibles et est destin√© uniquement aux administrateurs autoris√©s.</p>
                            <p style="margin: 5px 0;">G√©n√©r√© via le syst√®me KYC - ${new Date().toISOString().split('T')[0]}</p>
                        </div>
                    </div>
                `;
                
                // G√©n√©rer un nom de fichier avec date et heure
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-').substring(0, 19);
                const filename = `msbingo-kyc-history-${timestamp}.pdf`;
                
                // Dans un environnement r√©el, nous utiliserions une biblioth√®que comme html2pdf.js, jsPDF ou une API c√¥t√© serveur
                // Pour cette d√©mo, nous simulons la g√©n√©ration du PDF
                
                setTimeout(() => {
                    // Simulation de g√©n√©ration PDF - dans un cas r√©el, on utiliserait html2pdf ou jsPDF
                    document.body.removeChild(tmpDiv);
                    
                    showNotification(
                        'Export r√©ussi', 
                        'L\'historique a √©t√© export√© au format PDF. Le fichier sera t√©l√©charg√© automatiquement.',
                        'success'
                    );
                    
                    // Cr√©er un "faux" PDF pour la d√©mo - dans un environnement r√©el, ce serait le vrai PDF g√©n√©r√©
                    const demoBlob = new Blob([
                        `MS BINGO KYC - Rapport d'historique des v√©rifications\n`,
                        `G√©n√©r√© le ${new Date().toLocaleString('fr-FR')}\n\n`,
                        `Ce fichier est une d√©mo de g√©n√©ration PDF. Dans un environnement de production, un PDF complet serait g√©n√©r√©.\n`,
                        `Contenu: ${historyData.length} entr√©es d'historique de v√©rification.`
                    ], { type: 'text/plain' });
                    
                    const url = URL.createObjectURL(demoBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = filename;
                    link.style.display = 'none';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    setTimeout(() => {
                        URL.revokeObjectURL(url);
                    }, 100);
                }, 1500);
            }
            
            /**
             * Formate le type d'action pour l'affichage
             * @param {string} action - Type d'action
             * @returns {string} Action format√©e
             */
            function formatActionType(action) {
                switch (action) {
                    case 'approved': return 'Approuv√©';
                    case 'rejected': return 'Refus√©';
                    case 'flagged': return 'Signal√©';
                    case 'commented': return 'Comment√©';
                    default: return action || 'Action';
                }
            }
            
            /**
             * Formate le type de document pour l'affichage
             * @param {string} type - Type de document
             * @returns {string} Type format√©
             */
            function formatDocumentType(type) {
                switch (type) {
                    case 'identity_card': return 'Carte d\'identit√©';
                    case 'passport': return 'Passeport';
                    case 'driver_license': return 'Permis de conduire';
                    case 'residence_proof': return 'Justificatif de domicile';
                    case 'selfie': return 'Selfie';
                    default: return type || 'Document';
                }
            }
            
            /**
             * Programmation d'un rapport automatique
             * @param {string} frequency - Fr√©quence: 'daily', 'weekly', 'monthly'
             */
            function scheduleReport(frequency) {
                // R√©cup√©rer les rapports programm√©s existants
                let scheduledReports = JSON.parse(localStorage.getItem('scheduledReports') || '[]');
                
                // Configuration du rapport programm√©
                const reportConfig = {
                    id: Date.now(),
                    frequency: frequency,
                    format: 'pdf',
                    filter: 'all',
                    email: '',
                    createdAt: new Date().toISOString(),
                    nextRun: calculateNextRunDate(frequency)
                };
                
                // Demander l'adresse email pour l'envoi
                const email = prompt('Veuillez entrer l\'adresse email pour recevoir le rapport:');
                
                if (!email) {
                    showNotification('Programmation annul√©e', 'Vous devez sp√©cifier une adresse email pour recevoir le rapport.', 'warning');
                    return;
                }
                
                // V√©rifier le format de l'email
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    showNotification('Format d\'email invalide', 'Veuillez entrer une adresse email valide.', 'error');
                    return;
                }
                
                reportConfig.email = email;
                
                // Demander le type de filtre
                const filterOptions = ['Tous les documents', 'Documents √† risque √©lev√©'];
                const filterSelect = prompt(
                    'S√©lectionnez le type de documents √† inclure dans le rapport (1 ou 2):\n' +
                    '1. Tous les documents\n' +
                    '2. Documents √† risque √©lev√© uniquement'
                );
                
                if (filterSelect === '2') {
                    reportConfig.filter = 'high-risk';
                }
                
                // Ajouter le rapport √† la liste
                scheduledReports.push(reportConfig);
                
                // Sauvegarder dans le stockage local
                localStorage.setItem('scheduledReports', JSON.stringify(scheduledReports));
                
                // Formater l'affichage de la fr√©quence
                let frequencyText = '';
                switch (frequency) {
                    case 'daily': frequencyText = 'quotidien'; break;
                    case 'weekly': frequencyText = 'hebdomadaire'; break;
                    case 'monthly': frequencyText = 'mensuel'; break;
                }
                
                // Afficher la confirmation
                showNotification(
                    'Rapport programm√©',
                    `Un rapport ${frequencyText} sera envoy√© √† ${email} √† partir du ${new Date(reportConfig.nextRun).toLocaleDateString('fr-FR')}.`,
                    'success'
                );
            }
            
            /**
             * Calcule la prochaine date d'ex√©cution du rapport
             * @param {string} frequency - Fr√©quence du rapport
             * @returns {string} Date de prochaine ex√©cution
             */
            function calculateNextRunDate(frequency) {
                const now = new Date();
                let nextRun = new Date(now);
                
                switch (frequency) {
                    case 'daily':
                        // Le lendemain √† 8h du matin
                        nextRun.setDate(now.getDate() + 1);
                        nextRun.setHours(8, 0, 0, 0);
                        break;
                    case 'weekly':
                        // Le lundi suivant √† 8h du matin
                        const daysUntilMonday = 1 + (7 - now.getDay()) % 7; // 1 = lundi
                        nextRun.setDate(now.getDate() + daysUntilMonday);
                        nextRun.setHours(8, 0, 0, 0);
                        break;
                    case 'monthly':
                        // Le 1er du mois suivant √† 8h du matin
                        nextRun.setMonth(now.getMonth() + 1);
                        nextRun.setDate(1);
                        nextRun.setHours(8, 0, 0, 0);
                        break;
                }
                
                return nextRun.toISOString();
            }
            
            /**
             * Affiche la liste des rapports programm√©s
             */
            function showScheduledReports() {
                const scheduledReports = JSON.parse(localStorage.getItem('scheduledReports') || '[]');
                
                if (scheduledReports.length === 0) {
                    showNotification('Aucun rapport programm√©', 'Vous n\'avez pas encore programm√© de rapports automatiques.', 'info');
                    return;
                }
                
                // Cr√©ation d'une vue HTML pour afficher les rapports programm√©s
                let reportsList = '<div style="max-height: 400px; overflow-y: auto;">';
                reportsList += '<table style="width: 100%; border-collapse: collapse;">';
                reportsList += '<thead><tr style="background-color: #f5f5f5;">';
                reportsList += '<th style="padding: 10px; text-align: left; border-bottom: 1px solid #e0e0e0;">Fr√©quence</th>';
                reportsList += '<th style="padding: 10px; text-align: left; border-bottom: 1px solid #e0e0e0;">Type</th>';
                reportsList += '<th style="padding: 10px; text-align: left; border-bottom: 1px solid #e0e0e0;">Email</th>';
                reportsList += '<th style="padding: 10px; text-align: left; border-bottom: 1px solid #e0e0e0;">Prochaine ex√©cution</th>';
                reportsList += '<th style="padding: 10px; text-align: left; border-bottom: 1px solid #e0e0e0;">Action</th>';
                reportsList += '</tr></thead><tbody>';
                
                scheduledReports.forEach(report => {
                    let frequencyText = '';
                    switch (report.frequency) {
                        case 'daily': frequencyText = 'Quotidien'; break;
                        case 'weekly': frequencyText = 'Hebdomadaire'; break;
                        case 'monthly': frequencyText = 'Mensuel'; break;
                    }
                    
                    let filterText = report.filter === 'high-risk' ? 'Risque √©lev√© uniquement' : 'Tous les documents';
                    
                    const nextRunDate = new Date(report.nextRun).toLocaleString('fr-FR');
                    
                    reportsList += '<tr style="border-bottom: 1px solid #f0f0f0;">';
                    reportsList += `<td style="padding: 10px;">${frequencyText}</td>`;
                    reportsList += `<td style="padding: 10px;">${filterText}</td>`;
                    reportsList += `<td style="padding: 10px;">${report.email}</td>`;
                    reportsList += `<td style="padding: 10px;">${nextRunDate}</td>`;
                    reportsList += `<td style="padding: 10px;"><button onclick="deleteScheduledReport(${report.id})" style="background-color: #ffebee; color: #c62828; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Supprimer</button></td>`;
                    reportsList += '</tr>';
                });
                
                reportsList += '</tbody></table></div>';
                
                // Cr√©ation d'un modal pour afficher les rapports
                const modalDiv = document.createElement('div');
                modalDiv.id = 'scheduled-reports-modal';
                modalDiv.className = 'admin-modal';
                modalDiv.style.opacity = '0';
                modalDiv.style.visibility = 'hidden';
                
                modalDiv.innerHTML = `
                    <div class="admin-modal-content" style="max-width: 800px;">
                        <div class="admin-modal-header">
                            <h3>Rapports programm√©s</h3>
                            <button id="scheduled-reports-close" class="admin-modal-close">&times;</button>
                        </div>
                        <div class="admin-modal-body">
                            <p>Voici la liste des rapports automatiques programm√©s :</p>
                            ${reportsList}
                        </div>
                        <div class="admin-modal-footer">
                            <button id="close-scheduled-reports" class="admin-button secondary">Fermer</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modalDiv);
                
                // Afficher le modal
                setTimeout(() => {
                    const modal = document.getElementById('scheduled-reports-modal');
                    modal.style.opacity = '1';
                    modal.style.visibility = 'visible';
                    
                    // √âv√©nements pour fermer le modal
                    document.getElementById('scheduled-reports-close').addEventListener('click', () => {
                        modal.style.opacity = '0';
                        modal.style.visibility = 'hidden';
                        setTimeout(() => {
                            document.body.removeChild(modal);
                        }, 300);
                    });
                    
                    document.getElementById('close-scheduled-reports').addEventListener('click', () => {
                        modal.style.opacity = '0';
                        modal.style.visibility = 'hidden';
                        setTimeout(() => {
                            document.body.removeChild(modal);
                        }, 300);
                    });
                }, 10);
                
                // Fonction globale pour supprimer un rapport programm√©
                window.deleteScheduledReport = function(id) {
                    const scheduledReports = JSON.parse(localStorage.getItem('scheduledReports') || '[]');
                    const updatedReports = scheduledReports.filter(report => report.id !== id);
                    localStorage.setItem('scheduledReports', JSON.stringify(updatedReports));
                    
                    // Fermer le modal et le r√©afficher avec les donn√©es mises √† jour
                    const modal = document.getElementById('scheduled-reports-modal');
                    document.body.removeChild(modal);
                    showScheduledReports();
                    
                    showNotification('Rapport supprim√©', 'Le rapport programm√© a √©t√© supprim√© avec succ√®s.', 'success');
                };
            }
        });
    </script>
    
    <!-- Modal des facteurs de risque -->
    <div id="risk-factors-modal" class="admin-modal">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h3>Analyse des facteurs de risque</h3>
                <button id="risk-factors-close" class="modal-close">&times;</button>
            </div>
            <div class="admin-modal-body">
                <div class="risk-factor-summary">
                    <h4>Score de risque global</h4>
                    <div class="risk-score-gauge-large">
                        <div id="risk-gauge-fill" class="risk-score-fill" style="width: 65%;"></div>
                    </div>
                    <div class="risk-score-label">
                        <span id="risk-score-percent">65%</span>
                        <span id="risk-level-text">Risque moyen</span>
                    </div>
                </div>
                
                <div class="risk-factors-container">
                    <h4>D√©tail des facteurs contributifs</h4>
                    <div class="risk-factors-list" id="risk-factors-list">
                        <!-- Les facteurs de risque seront inject√©s ici par JavaScript -->
                    </div>
                </div>
                
                <div class="risk-recommendation">
                    <h4>Recommandation</h4>
                    <p id="risk-recommendation-text">V√©rification manuelle recommand√©e par un agent. Des incoh√©rences mineures ont √©t√© d√©tect√©es.</p>
                </div>
                
                <div class="admin-form-group">
                    <button id="notify-risk-btn" class="admin-button warning" style="width: 100%;">
                        Envoyer notification √† l'√©quipe de conformit√©
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Script RGPD pour la gestion des consentements cookies -->
    <script src="/js/cookie-consent.js"></script>
</body>
</html>